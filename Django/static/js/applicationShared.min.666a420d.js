angular.module("hereApp.values",[]),angular.module("hereApp.service.user",[]),angular.module("hereApp.service",["hereApp.service.user"]),angular.module("hereApp.directive",["ngSanitize","hereApp.templates","hereApp.service"]),angular.module("hereApp.filters.sort",[]),angular.module("hereApp.filters",["hereApp.filters.sort"]),angular.module("hereApp.account",["hereApp.service"]),angular.module("hereApp.templates",[]),angular.module("hereApp",["ngSanitize","ngRoute","ngCookies","hereApp.values","hereApp.service","hereApp.directive","hereApp.filters","hereApp.templates","hereApp.account"]),angular.module("hereApp.values").value("AppEnums",{flow:{SELF_SERVE_EC:"ssx-ec",SIGNUP:"sign-up",CONVERSION_SIGN_IN:"conversion-sign-in",SIGN_IN:"sign-in"},messageType:{ABORTED:"aborted",COMPLETED:"completed",ERROR:"error",FRAME_RESIZED:"frame resized",SIGN_IN_INSTEAD:"sign in instead",VERIFY_EMAIL_SENT:"verify email sent",VERIFY_EMAIL_FAILED:"verify email failed",EDIT_EMAIL_ADDRESS:"edit email address",CONVERSION_SIGN_IN_SUCCESS:"conversion sign in success",CONVERSION_SIGN_IN_FAILED:"conversion sign in failed"}}),angular.module("hereApp.values").value("errorMappingValue",{mappings:{firstname:{400201:"missing",400202:"empty",400203:"invalid",400205:"blacklisted"},lastname:{400201:"missing",400202:"empty",400203:"invalid",400205:"blacklisted"},email:{400201:"missing",400202:"empty",400203:"invalid",400205:"blacklisted",400240:"illegal",400601:"reacceptTerms",409e3:"conflict",401600:"noAccountFound",412100:"federatedAcctNoPw"},passwordNew:{400201:"missing",400202:"empty",400203:"invalid",400220:"invalid",400205:"blacklisted",400206:"tooShort",400221:"sameAsEmail"},passwordConfirm:{400201:"missing",400202:"empty",401250:"wrong"},country:{400260:"illegal",400261:"embargoed"},dob:{400210:"invalid",400211:"forbidden",400212:"inFuture",400213:"notInRange"},captcha:{400201:"missing",400202:"empty",400203:"invalid"},phoneNumber:{400201:"missing",400202:"empty",400203:"invalid",400250:"invalid"},language:{400270:"illegal"},channelValue:{},passcode:{400201:"empty",400202:"empty",400204:"invalid",401114:"invalid",412306:"invalid"}},handle:function(errorFields,callback){"use strict";if(errorFields&&errorFields.length){for(var errorType,errorName,errorCode,arrayMappedErrors=[],i=errorFields.length-1;0<=i;i--)errorName=(errorType=errorFields[i]).name,errorCode=errorType.errorCode,errorType=this.mappings[errorName="oldPassword"===(errorName="newPassword"===(errorName="password"===errorName?"passwordNew":errorName)?"passwordNew":errorName)?"passwordConfirm":errorName]&&this.mappings[errorName][errorCode],errorName&&errorCode&&errorType&&arrayMappedErrors.push({name:errorName,type:errorType});return"function"==typeof callback?callback(function(scopeNotificationsRef){arrayMappedErrors.map(function(error){scopeNotificationsRef[error.name][error.type]=!0})}):Error("Callback is not function type.")}return Error("Errors are empty or invalid.")}}),angular.module("hereApp").config(function($routeProvider,$locationProvider){"use strict";var customisedSignInScreenTemplate="";window.here.config.sdk&&window.here.config.sdk.signInTemplate&&(customisedSignInScreenTemplate=window.here.config.sdk.signInTemplate+"/"),$routeProvider.when("/sign-in",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formSignIn"}).when("/conversion-sign-in",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formSignIn"}).when("/sign-in-mob",{templateUrl:"/templates/accountSharedPage/signInForm"}).when("/sign-up",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formSignUp"}).when("/reset-password",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formResetPassword"}).when("/forgot-org-id",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formForgotOrgId"}).when("/resend-invite",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formResendInvite"}).when("/email-verify",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"formEmailVerify"}).when("/welcome",{templateUrl:"/templates/accountSharedPage/formWelcome",controller:"AccountSignUpPageCtrl"}).when("/channels",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"mfaChannelsShared",controller:"AccountChannelsPageCtrl"}).when("/window/done",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"windowDone"}).when("/welcome-auth",{templateUrl:"/templates/accountSharedPage/formSignInWelcome",controller:"AccountSignInPageCtrl"}).when("/terms",{templateUrl:"/templates/accountSharedPage/formSignInTerms",controller:"AccountSignInPageCtrl"}).when("/termsOlp",{templateUrl:"/templates/accountSharedPage/formSignInTerms",controller:"AccountSignInPageOlpCtrl"}).when("/platform-terms",{templateUrl:"/templates/accountSharedPage/olp/formPlatformTerms",controller:"AccountSignInPageOlpCtrl"}).when("/dob-required",{templateUrl:"/templates/accountSharedPage/formSignInDOB",controller:"AccountSignInPageCtrl"}).when("/reset-password-done",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"infoResetPasswordDone"}).when("/forgot-org-id-done",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"infoForgotOrgIdDone"}).when("/resend-invite-done",{templateUrl:"/templates/accountSharedPage/"+customisedSignInScreenTemplate+"infoResendInviteDone"}).when("/unsubscribe",{templateUrl:"/templates/emailUnsubscribeViewPage",controller:"EmailUnsubscribeViewPageCtrl"}).when("/password-change",{templateUrl:"/templates/passwordChangePage",controller:"PasswordChangePageCtrl"}).when("/forbidden",{templateUrl:"/templates/accountSharedPage/infoForbidden"}).when("/",{redirectTo:"/"+window.here.page}).otherwise({redirectTo:"/sign-in"}),$locationProvider.html5Mode(!0)}),angular.module("hereApp.filters.sort").filter("sortAlphabeticalyFilterBy",function(){"use strict";return function(items,field,reverse){var compared,filtered=[];return angular.forEach(items,function(item){filtered.push(item)}),filtered.sort(function(a,b){return 0<(compared=a[field].localeCompare(b[field]))?1:compared<0?-1:0}),reverse&&filtered.reverse(),filtered}}),angular.module("hereApp.service.user").factory("UserService",function($window,$http){"use strict";function getDefaultConfig(realm){return{cache:!1,method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","x-csrf-token":window.localStorage.getItem("csrfToken")||$window.here.csrf,"x-realm":realm||$window.here.realm,"x-sdk":$window.here.config.sdk&&!0===$window.here.config.sdk.active,"x-oidc":$window.here.config.sdk&&!0===$window.here.config.sdk.oidc||null,"x-uri":$window.here.config.sdk&&$window.here.config.sdk.uri||null,"x-client":$window.here.config.sdk&&$window.here.config.sdk.clientId||$window.here.config.clientId,"x-correlation-id":$window.here.config.sdk&&$window.here.config.sdk.correlationId?$window.here.config.sdk.correlationId:null},responseType:"json"}}var routes={urlSignInWithPassword:"/api/account/sign-in-with-password",urlSignInUserInfo:"/api/account/sign-in-user-info",urlsOAuth:{facebook:"/api/account/sign-in-with-facebook",google:"/api/account/sign-in-with-google",arcgis:"/api/account/sign-in-with-arcgis",heread:"/api/account/sign-in-with-heread",verimi:"/api/account/sign-in-with-verimi",verimiToken:"/api/account/get-verimi-token"},urlMfaCodeEntered:"/api/account/verify-mfa-code",urlSignOut:"/api/account/sign-out",urlResetPassword:"/api/account/reset-password",urlForgotOrgId:"/api/account/forgot-org-id",urlResendInvite:"/api/account/resend-invite",urlEmailVerifyReq:"/api/account/email-verify-req",urlMfaSmsGenerateOTP:"/api/account/mfa-sms-generate-otp",urlRequestTerms:"/api/account/terms",urlAcceptTerms:"/api/account/reaccept-terms",urlGetPlatformTerms:"/api/account/getPlatformTerms",urlGetPlatformTermsInfo:"/api/account/getPlatformTermsInfo",urlAcceptPlatformTerms:"/api/account/acceptPlatformTerms",urlDobRequired:"/api/account/dobRequired",urlActivateAuthzn:"/api/account/activate-authorization",urlCreateUser:"/api/account",urlReadUser:"/api/account",urlUpdateUser:"/api/account",urlDiveInUser:"/api/account/diveIn",urlUpdateEmail:"/api/account/email",urlUpdatePassword:"/api/account/password",urlChangeUserPassword:"/api/account/change-password",urlEmailVerifyPage:"/api/account/email-verify-page",urlDeactivateUser:"/api/account/deactivate",urlDeleteUser:"/api/account/delete",urlSetMFARequired:"/api/account/set-mfa-required-client",urlGetMFARequired:"/api/account/get-mfa-required-clients",urlGetMFAChannels:"/api/account/mfaChannels",urlCreateMFAChannel:"/api/account/mfaChannel",urlDeleteMFAChannel:"/api/account/mfaChannel",urlPostAuthorize:"/authorize",urlSaveConsent:"/api/account/save-consent",urlCreateRealm:"/api/account/realm"},user={data:{},dataTmp:{},dataResponse:{},sessionData:{},nots:"Nothing",activateAuthorization:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlActivateAuthzn,data:{givenToken:configLocal.givenToken,userId:configLocal.userId}});this._performRequest(configLocal,callback)},signInWithPassword:function(uatDuration,callback){var configLocal=uatDuration.realm||($window.here.config.sdk?$window.here.config.sdk.realm:"here"),configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlSignInWithPassword,data:{realm:configLocal,email:uatDuration.email,password:uatDuration.password,rememberMe:uatDuration.rememberMe,isConversionSignIn:uatDuration.isConversionSignIn||!1}}),uatDuration=uatDuration.uatDuration||($window.here.config.sdk?$window.here.config.sdk.uatDuration:"");""!==uatDuration&&(configLocal.data.expiresIn=uatDuration),this._performRequest(configLocal,callback)},saveConsent:function(params,callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlSaveConsent,data:{realm:params.realm,clientId:params.clientId,scope:params.scope}});configLocal.headers["x-realm"]=params.realm,this._performRequest(configLocal,callback)},postAuthorize:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlPostAuthorize,data:configLocal});configLocal.headers["Content-Type"]="application/x-www-form-urlencoded",this._performRequest(configLocal,callback)},acceptTermsWithToken:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlAcceptTerms,data:{token:configLocal.token}});this._performRequest(configLocal,callback)},saveDobRequiredWithToken:function(configLocal,callback){this.dataTmp.dob=(1===(""+this.dataTmp.dobTmp.day).length?"0"+this.dataTmp.dobTmp.day:""+this.dataTmp.dobTmp.day)+"/"+(1===(""+this.dataTmp.dobTmp.month).length?"0"+this.dataTmp.dobTmp.month:""+this.dataTmp.dobTmp.month)+"/"+this.dataTmp.dobTmp.year;configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlDobRequired,data:{dob:this.dataTmp.dob,token:configLocal.token}});this._performRequest(configLocal,callback)},getVerimiAccessToken:function(uatDuration,callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlsOAuth.verimiToken,data:{redirectUri:uatDuration.redirectUri,code:uatDuration.code,language:uatDuration.language||null}});configLocal.headers["x-realm"]=uatDuration.realm;uatDuration=uatDuration.uatDuration||($window.here.config.sdk?$window.here.config.sdk.uatDuration:"");""!==uatDuration&&(configLocal.data.expiresIn=uatDuration),$http(configLocal).then(function(response){user.dataTmp.authFed.accessToken=response.data.accessToken,user.dataTmp.authFed.idToken=response.data.idToken,user.dataTmp.authFed.userId=response.data.userId,user.dataTmp.authFed.expiresIn=response.data.expiresIn,412001===response.data.errorCode||201===response.status?callback(response.status,412):callback(null,response.status)},function(response){callback(response.body||!0,response.status)})},signInWithAuthFederation:function(authName,uatDuration,callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlsOAuth[authName],data:{accessToken:uatDuration.accessToken,realm:uatDuration.realm,countryCode:uatDuration.countryCode||null,language:uatDuration.language||null,email:uatDuration.email,rememberMe:uatDuration.rememberMe}});"verimi"===authName&&(configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlsOAuth[authName],data:{redirectUri:uatDuration.redirectUri,code:uatDuration.code,idToken:uatDuration.idToken,realm:uatDuration.realm,language:uatDuration.language||null,accessToken:uatDuration.accessToken}}),uatDuration.userId&&(configLocal.data.userId=uatDuration.userId),uatDuration.expiresIn&&(configLocal.data.expiresIn=uatDuration.expiresIn)),configLocal.data.isConversionSignIn=uatDuration.isConversionSignIn||!1,$window.here.config.sdk&&$window.here.config.sdk.inviteToken&&(configLocal.data.inviteToken=$window.here.config.sdk.inviteToken),configLocal.headers["x-realm"]=uatDuration.realm;uatDuration=uatDuration.uatDuration||($window.here.config.sdk?$window.here.config.sdk.uatDuration:"");uatDuration&&(configLocal.data.expiresIn=uatDuration),$http(configLocal).then(function(response){412001===response.data.errorCode?callback(response.data,412):callback(null,response.data)},function(response){callback(response.data||!0,response.status)})},updateMarketing:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlUpdateUser,data:{marketingEnabled:configLocal},method:"PUT"});this._performRequest(configLocal,!0,callback)},signOut:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlSignOut,method:"GET",headers:{Accept:"application/json"},responseType:"json"});this._performRequest(configLocal,callback)},passwordResetRequest:function(callback){var configLocal=this.dataTmp.realm||($window.here.config.sdk?$window.here.config.sdk.realm:"here"),configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlResetPassword,data:{realm:configLocal,email:this.dataTmp.email,captcha:this.dataTmp.captcha}});this._performRequest(configLocal,callback)},forgotOrgIdRequest:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlForgotOrgId,data:{email:this.dataTmp.email,captcha:this.dataTmp.captcha}});this._performRequest(configLocal,callback)},resendInviteRequest:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlResendInvite,data:{email:this.dataTmp.email,captcha:this.dataTmp.captcha}});this._performRequest(configLocal,callback)},emailVerifyRequest:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlEmailVerifyReq,data:{email:this.data.email}});this._performRequest(configLocal,callback)},getTermsOfCountry:function(countryCode,callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlRequestTerms,data:{countryCode:countryCode}});return countryCode&&""!==countryCode||(configLocal.data.countryCode="USA"),this._performRequest(configLocal,callback)},getPlatformTermsLink:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlGetPlatformTerms,method:"GET"});return this._performRequest(configLocal,callback)},getPlatformTermsInfo:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlGetPlatformTermsInfo,method:"GET"});return this._performRequest(configLocal,callback)},acceptPlatformTerms:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlAcceptPlatformTerms});return this._performRequest(configLocal,callback)},getTermsOfCurrentCountry:function(callback){return this.countryCurrent.code&&""!==this.countryCurrent.code?user.getTermsOfCountry(this.countryCurrent.code,callback):("function"==typeof callback&&callback(null,200),!1)},getSignInUserInfo:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlSignInUserInfo,data:{email:this.dataTmp.email}});configLocal.headers["x-correlation-id"]=$window.here.config.sdk.correlationId,this._performRequest(configLocal,callback)},createOlpRealmForSSX:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlCreateRealm,data:{firstname:this.dataTmp.firstname,lastname:this.dataTmp.lastname,email:this.dataTmp.email,companyname:this.dataTmp.companyname,captcha:this.dataTmp.captcha,clientData:$window.here.config.sdk.clientData||"",channel:$window.here.config.sdk.clmChannel||""}});configLocal.headers["x-correlation-id"]=$window.here.config.sdk.correlationId,this._performRequest(configLocal,callback)},readUser:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlReadUser,method:"GET"});this._performRequest(configLocal,!0,callback)},createUser:function(passwordNew,callback){$window.here.config.sdk.selfCertifyAge||(this.dataTmp.dob=(1===(""+this.dataTmp.dobTmp.day).length?"0"+this.dataTmp.dobTmp.day:""+this.dataTmp.dobTmp.day)+"/"+(1===(""+this.dataTmp.dobTmp.month).length?"0"+this.dataTmp.dobTmp.month:""+this.dataTmp.dobTmp.month)+"/"+this.dataTmp.dobTmp.year);var inviteToken=$window.here.config.sdk?$window.here.config.sdk.inviteToken:"",configLocal=$window.here.config.sdk?$window.here.config.sdk.realm:"here",configLocal=angular.extend({password:passwordNew,inviteToken:inviteToken,realm:configLocal},this.dataTmp),configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlCreateUser,data:configLocal,method:"POST"});$window.here.config.sdk&&$window.here.config.sdk.uatDuration&&""!==$window.here.config.sdk.uatDuration&&(configLocal.data.expiresIn=$window.here.config.sdk.uatDuration),$window.here.config.mfaEmailAddr&&""!==$window.here.config.mfaEmailAddr&&"null"!==$window.here.config.mfaEmailAddr&&angular.extend(configLocal.headers,{"x-email":$window.here.config.mfaEmailAddr}),this._performRequest(configLocal,!0,callback)},updateUser:function(callback){this.dataTmp.dobTmp.day&&this.dataTmp.dobTmp.month&&this.dataTmp.dobTmp.year?this.dataTmp.dob=(1===(""+this.dataTmp.dobTmp.day).length?"0"+this.dataTmp.dobTmp.day:""+this.dataTmp.dobTmp.day)+"/"+(1===(""+this.dataTmp.dobTmp.month).length?"0"+this.dataTmp.dobTmp.month:""+this.dataTmp.dobTmp.month)+"/"+this.dataTmp.dobTmp.year:this.dataTmp.dob="";var configLocal={realm:$window.here.config.sdk?$window.here.config.sdk.realm:"here",dob:this.dataTmp.dob,firstname:this.dataTmp.firstname,lastname:this.dataTmp.lastname,oldCountryCode:this.data.countryCode,countryCode:this.dataTmp.countryCode,language:this.dataTmp.language,marketingEnabled:this.dataTmp.marketingEnabled,phoneNumber:this.dataTmp.phoneNumber},configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlUpdateUser,data:configLocal,method:"PUT"});this._performRequest(configLocal,!0,callback)},diveInUser:function(configLocal,callback){var realm=$window.here.config.sdk?$window.here.config.sdk.realm:"here",configLocal=angular.extend({password:configLocal,realm:realm},this.dataTmp),configLocal=angular.extend(angular.copy(getDefaultConfig(realm)),{url:routes.urlDiveInUser,data:configLocal,method:"PUT"});this._performRequest(configLocal,!0,callback)},updateEmail:function(configLocal,callback){configLocal={emailNew:this.dataTmp.email,email:this.data.email,password:configLocal,captcha:this.dataTmp.captcha},configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlUpdateEmail,data:configLocal,method:"PUT"});this._performRequest(configLocal,!0,callback)},updatePassword:function(configLocal,passwordNew,callback){configLocal={newPassword:passwordNew,oldPassword:configLocal,email:this.data.email,realm:this.dataTmp.realm||"here"},configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlUpdatePassword,data:configLocal,method:"PUT"});this._performRequest(configLocal,!0,callback)},changeUserPassword:function(passwordResetToken,configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlChangeUserPassword,data:{token:passwordResetToken,newPassword:configLocal},method:"POST"});this._performRequest(configLocal,!0,callback)},deactivateUser:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlDeactivateUser});this._performRequest(configLocal,!0,callback)},deleteUser:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlDeleteUser,method:"DELETE"});this._performRequest(configLocal,!0,callback)},setMFARequiredForClientId:function(configLocal,callback){configLocal={mfaClientIdArray:configLocal},configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlSetMFARequired,data:configLocal,method:"POST"});this._performRequest(configLocal,!1,callback)},getMFARequiredClientIds:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlGetMFARequired,method:"GET"});this._performRequest(configLocal,!0,callback)},getMFAChannels:function(callback){var configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlGetMFAChannels,method:"GET"});this._performRequest(configLocal,!1,callback)},createMFAChannel:function(configLocal,callback){configLocal={type:configLocal.type,value:configLocal.value},configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlCreateMFAChannel,data:configLocal,method:"POST"});this._performRequest(configLocal,!1,callback)},deleteMFAChannel:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlDeleteMFAChannel+"/"+configLocal,method:"DELETE"});this._performRequest(configLocal,!1,callback)},mfaCodeEntered:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlMfaCodeEntered,data:{channelId:configLocal.channelId,passcode:configLocal.passcode}});this._performRequest(configLocal,!1,callback)},mfaSmsGenerateOTP:function(configLocal,callback){configLocal=angular.extend(angular.copy(getDefaultConfig()),{url:routes.urlMfaSmsGenerateOTP,data:{channelId:configLocal.channelId}});this._performRequest(configLocal,!1,callback)},_performRequest:function(configLocal,overrideData,callback){var data,that=this;"function"==typeof overrideData&&(callback=overrideData,overrideData=!1),"function"!=typeof callback&&(callback=function(){}),$http(configLocal).then(function(response){overrideData&&that._copyDataTmpIntoData(),response.data&&"object"==typeof response.data||(response.data={}),response.data.status=response.status,response.data.errs=!1,callback(null,response.data)},function(response){data={status:response.status,errs:response.data&&response.data.errorFields||response.data||!0},callback(response.data&&response.data.errorFields||response.data||!0,data)})},_ajaxRequest:function(url,verb,callback){var formData=verb.formData||{},verb=verb.verb||"POST",xhr=new XMLHttpRequest;xhr.open(verb,url,!0),xhr.setRequestHeader("x-csrf-token",window.localStorage.getItem("csrfToken")||$window.here.csrf),xhr.setRequestHeader("x-realm",$window.here.realm),xhr.onreadystatechange=function(){xhr.readyState===XMLHttpRequest.DONE&&callback(xhr.status,xhr.response)},xhr.send(formData)},restoreData:function(){var temp={mfaAllChannels:this.dataTmp.mfaAllChannels,mfaVerifiedChannels:this.dataTmp.mfaVerifiedChannels,mfaLoggedInState:this.dataTmp.mfaLoggedInState,otpRequestedChannels:this.dataTmp.otpRequestedChannels,passcodes:this.dataTmp.passcodes};this._copyDataIntoDataTmp(),temp.mfaAllChannels&&(this.dataTmp.mfaAllChannels=temp.mfaAllChannels),temp.mfaVerifiedChannels&&(this.dataTmp.mfaVerifiedChannels=temp.mfaVerifiedChannels),temp.mfaLoggedInState&&(this.dataTmp.mfaLoggedInState=temp.mfaLoggedInState),temp.otpRequestedChannels&&(this.dataTmp.otpRequestedChannels=temp.otpRequestedChannels),temp.passcodes&&(this.dataTmp.passcodes=temp.passcodes),this.countryCurrent=this.countries[this.getCountryKeyByCountryCode(this.data.countryCode)]},_copyDataIntoDataTmp:function(){this.dataTmp=angular.copy(this.data)},_copyDataTmpIntoData:function(){this.data=angular.copy(this.dataTmp)},getCountryKeyByCountryCode:function(countryCode){countryCode=countryCode||this.dataTmp.countryCode;for(var i=this.countries.length-1;0<=i;i--)if(this.countries[i].code===countryCode)return i;return 0},setCountryCode:function(){this.dataTmp.countryCode=this.countryCurrent.code},testTerms:function(){return this.dataTmp.countryCode!==this.data.countryCode&&-1<$window.here.config.explicitTermsCountries.indexOf(this.dataTmp.countryCode)?"explicit":this.dataTmp.countryCode!==this.data.countryCode&&"implicit"},changeCountry:function(){this.dataTmp.countryCode=this.countryCurrent.code}};return user._validationPatterns={name:/^(.+)$/,email:$window.here.emailExpression,phoneNumber:$window.here.phoneNumberExpression,password:/^[\u0020-\u007E\u00A1-\uFFEF]{6,}$/,mfaSmsNumber:$window.here.mfaSmsChannelValueExpression,dateOfBirth:/\d{1,2}\/\d{1,2}\/\d{4}/},user.validateFirstname=function(firstname){return this._validationPatterns.name.test(firstname||this.dataTmp.firstname)},user.validateLastname=function(lastname){return this._validationPatterns.name.test(lastname||this.dataTmp.lastname)},user.validateEmail=function(email){return this._validationPatterns.email.test(email||this.dataTmp.email)},user.validatePhoneNumber=function(phoneNumber){return this._validationPatterns.phoneNumber.test(phoneNumber||this.dataTmp.phoneNumber)},user.validateChannelValue=function(channelValue){return this._validationPatterns.mfaSmsNumber.test(channelValue||this.dataTmp.channelValue)},user.validatePassword=function(password){return this._validationPatterns.password.test(password)},user.validateDateOfBirth=function(year,month,day){return 13<=(new Date-new Date(year||this.dataTmp.dobTmp.year,month||this.dataTmp.dobTmp.month,day||this.dataTmp.dobTmp.day))/31536e6},user._validateData=function(){return this.validateEmail()&&this.validateFirstname()&&this.validateLastname()},user.hasGrantType=function(grantType){return!!(user.data&&user.data.accountType&&-1<user.data.accountType.indexOf(grantType))},user.countries={},user.countryCurrent=null,user.data=$window.here.user.data,user.data.dobTmp={},user.termsTemplates=$window.here.terms,user.locale=$window.here.user.locale,user.countries=$window.here.countries,user.countryInit=user.getCountryKeyByCountryCode(user.data.countryCode),user.countryCurrent=null,user.platformTermsLink="",user.restoreData(),user}),angular.module("hereApp.service.user").factory("NotificationService",function(){"use strict";var notifications={showFixedNotification:!1,fixedNotificationContent:"",fixedNotificationType:"",showNotification:function(type,content){this.fixedNotificationType=type,this.fixedNotificationContent=content||this.fixedNotificationContent,this.showFixedNotification=!0},reset:function(){this.fixedNotificationType="",this.fixedNotificationContent="",this.showFixedNotification=!1}};return notifications}),angular.module("hereApp.account").controller("RootCtrl",function($scope,$window,$document,$location,UserService,errorMappingValue,$timeout,NotificationService,DataService,CommonService){"use strict";var localstorage=window.localStorage;$scope.account={flowRecovery:!1,isDevPortal:$window.here.config.sdk&&"KpJ3fgsK1MtlesswASHe8A"===$window.here.config.sdk.clientId},$scope.user=UserService,$scope.isSDK=$window.here.config.sdk&&!0===$window.here.config.sdk.active,$scope.isPlatformTermsReAcceptanceEnabled=$window.here.features.enablePlatformTermsReAcceptance;!function(){try{localstorage.setItem("csrfToken",$window.here.csrf)}catch(err){console.log("Error in setLatestCSRFToken :"),console.log(err)}}(),$scope.capitalize=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},$scope.fakePassword=function(){for(var randomLength=Math.floor(12*Math.random())+4,text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<randomLength;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text},$scope.terms={implicit:$scope.user.termsTemplates.implicit,explicit:$scope.user.termsTemplates.explicit,userzero:$scope.user.termsTemplates.userzero},$scope.testTerms=function(){return $scope.user.testTerms()},$scope.setTerms=function(callback){$scope.changings.loadingToS=!0,$scope.user.getTermsOfCurrentCountry(function(platformTermsUrl,data){if($scope.changings.loadingToS=!1,"function"!=typeof callback&&(callback=function(){}),platformTermsUrl)return callback(platformTermsUrl);if(data&&data.terms&&0<data.terms.length){$scope.terms.implicit=$scope.user.termsTemplates.implicit.replace("{{termsURL}}",data.terms[0].url.tos).replace("{{privacyURL}}",data.terms[0].url.pp),$scope.terms.implicit=$scope.terms.implicit.replace(/<a([^>])/g,'<a target="_blank"$1'),$scope.terms.explicit=$scope.user.termsTemplates.explicit.replace("{{termsURL}}",data.terms[0].url.tos).replace("{{privacyURL}}",data.terms[0].url.pp),$scope.terms.explicit=$scope.terms.explicit.replace(/<a([^>])/g,'<a target="_blank"$1'),$scope.isPlatformTermsReAcceptanceEnabled&&($scope.user.platformTermsLink||$scope.user.getPlatformTermsLink(function(err,platformTermsdata){platformTermsdata&&platformTermsdata.link&&($scope.user.platformTermsLink=platformTermsdata.link)}));platformTermsUrl=$scope.user.platformTermsLink||"https://legal.here.com/terms/here-platform";return $scope.terms.userzero=$scope.user.termsTemplates.userzero.replace("{{termsURL}}",data.terms[0].url.tos).replace("{{privacyURL}}",data.terms[0].url.pp).replace("{{prodTermsURL}}",platformTermsUrl).replace(/<a([^>])/g,'<a target="_blank"$1'),callback(null)}return callback(!0)})},$scope.notifications={errors:{},successes:{}},$scope.mappings=errorMappingValue.mappings,$scope.handleErrors=function(errorFields){errorFields&&errorMappingValue.handle(errorFields,function(mapper){mapper($scope.notifications.errors)})},$scope.unsetErrors=function(){$scope.notifications.errors={firstname:{},lastname:{},email:{},phoneNumber:{},password:{},passwordNew:{},passwordConfirm:{},channelValue:{},passcode:{},captcha:{},deactivate:{},delete:{},dob:{},country:{},realm:{}},NotificationService.reset()},$scope.unsetErrors(),$scope.unsetNotifications=function(field,all){field?all?angular.forEach($scope.notifications.errors,function(value,key){0<=key.indexOf(field)&&($scope.notifications.errors[key]=!1)}):($scope.notifications.errors[field]=!1,$scope.notifications.successes[field]=!1):($scope.unsetErrors(),$scope.notifications.successes={})},$scope.unsetChangings=function(){$scope.changings={}},$scope.unsetChangings(),$scope.flowDone=function(flow,data){$scope.isSDK?$scope.sdkComplete(flow,data):$scope.goToSignIn()},$scope.focusPwInput=function(elId){var element=$document[0].getElementById(elId);$timeout(function(){element.focus()})},$scope.clearPasswords=function(){$scope.account.passwords={}},$scope.clearPasswords(),$scope.account.passwordFake=$scope.fakePassword(),$scope.isEmpty=function(field){return!($scope.user.dataTmp[field]&&""!==$scope.user.dataTmp[field])},$scope.isEmptyPassword=function(field){return!($scope.account.passwords[field]&&""!==$scope.account.passwords[field])},$scope.isPasswordEqualToEmail=function(){return!(!$scope.account.passwords.passwordNew||!$scope.user.dataTmp.email||$scope.account.passwords.passwordNew!==$scope.user.dataTmp.email)},$scope.hasClientErrorsName=function(field){return!!$scope.isEmpty(field)},$scope.hasClientErrorsNameOnBlur=function(field){return!(!$scope.notifications.errors[field].blur||!$scope.hasClientErrorsName(field))},$scope.hasServerErrorsName=function(field){return!!($scope.notifications.errors[field].empty||$scope.notifications.errors[field].invalid||$scope.notifications.errors[field].blacklisted)},$scope.hasErrorsName=function(field){return!(!$scope.hasClientErrorsName(field)&&!$scope.hasServerErrorsName(field))},$scope.hasErrorsNameOnBlur=function(field){return!(!$scope.hasClientErrorsNameOnBlur(field)&&!$scope.hasServerErrorsName(field))},$scope.hasClientErrorsEmail=function(){return!(!$scope.isEmpty("email")&&!$scope.isInvalidEmail())},$scope.hasClientErrorsEmailOnBlur=function(){return!(!$scope.notifications.errors.email.blur||!$scope.hasClientErrorsEmail())},$scope.hasServerErrorsEmail=function(){return!!($scope.notifications.errors.email.empty||$scope.notifications.errors.email.invalid||$scope.notifications.errors.email.illegal||$scope.notifications.errors.email.blacklisted||$scope.notifications.errors.email.conflict)},$scope.hasErrorsEmail=function(){return!(!$scope.hasClientErrorsEmail()&&!$scope.hasServerErrorsEmail())},$scope.hasErrorsEmailOnBlur=function(){return!(!$scope.hasClientErrorsEmailOnBlur()&&!$scope.hasServerErrorsEmail())},$scope.hasClientErrorsPhoneNumber=function(){return!(!$scope.isEmpty("phoneNumber")&&!$scope.isInvalidPhoneNumber())},$scope.hasClientErrorsPhoneNumberOnBlur=function(){return!(!$scope.notifications.errors.phoneNumber.blur||!$scope.hasClientErrorsPhoneNumber())},$scope.hasServerErrorsPhoneNumber=function(){return!!($scope.notifications.errors.phoneNumber.empty||$scope.notifications.errors.phoneNumber.invalid||$scope.notifications.errors.phoneNumber.illegal)},$scope.hasErrorsPhoneNumber=function(){return!(!$scope.hasClientErrorsPhoneNumber()&&!$scope.hasServerErrorsPhoneNumber())},$scope.hasErrorsPhoneNumberOnBlur=function(){return!(!$scope.hasClientErrorsPhoneNumberOnBlur()&&!$scope.hasServerErrorsPhoneNumber())},$scope.hasClientErrorsPasswordNew=function(){return!!($scope.isEmptyPassword("passwordNew")||$scope.isPasswordEqualToEmail()||$scope.isInvalidPasswordNew())},$scope.hasClientErrorsPasswordNewOnBlur=function(){return!(!$scope.notifications.errors.passwordNew.blur||!$scope.hasClientErrorsPasswordNew())},$scope.hasServerErrorsPasswordNew=function(){return!!($scope.notifications.errors.passwordNew.empty||$scope.notifications.errors.passwordNew.invalid||$scope.notifications.errors.passwordNew.tooShort||$scope.notifications.errors.passwordNew.illegal||$scope.notifications.errors.passwordNew.blacklisted||$scope.notifications.errors.passwordNew.sameAsEmail)},$scope.hasErrorsPasswordNew=function(){return!(!$scope.hasClientErrorsPasswordNew()&&!$scope.hasServerErrorsPasswordNew())},$scope.hasErrorsPasswordNewOnBlur=function(){return!(!$scope.hasClientErrorsPasswordNewOnBlur()&&!$scope.hasServerErrorsPasswordNew())},$scope.hasClientErrorsPasswordConfirm=function(){return!!$scope.isEmptyPassword("passwordConfirm")},$scope.hasClientErrorsPasswordConfirmOnBlur=function(){return!(!$scope.notifications.errors.passwordConfirm.blur||!$scope.hasClientErrorsPasswordConfirm())},$scope.hasServerErrorsPasswordConfirm=function(){return!(!$scope.notifications.errors.passwordConfirm.empty&&!$scope.notifications.errors.passwordConfirm.wrong)},$scope.hasErrorsPasswordConfirm=function(){return!(!$scope.hasClientErrorsPasswordConfirm()&&!$scope.hasServerErrorsPasswordConfirm())},$scope.hasErrorsPasswordConfirmOnBlur=function(){return!(!$scope.hasClientErrorsPasswordConfirmOnBlur()&&!$scope.hasServerErrorsPasswordConfirm())},$scope.isInvalidEmail=function(){return!$scope.user.validateEmail()},$scope.isInvalidPhoneNumber=function(){return!$scope.user.validatePhoneNumber()},$scope.isInvalidChannelValue=function(){return!$scope.user.validateChannelValue()},$scope.isInvalidPasswordNew=function(){return!$scope.user.validatePassword($scope.account.passwords.passwordNew)},$scope.hasClientErrorsCaptcha=function(){return!!$scope.isEmpty("captcha")},$scope.hasClientErrorsCaptchaOnBlur=function(){return!(!$scope.notifications.errors.captcha.blur||!$scope.hasClientErrorsCaptcha())},$scope.hasServerErrorsCaptcha=function(field){return!!($scope.notifications.errors.captcha.empty||$scope.notifications.errors.captcha.invalid||$scope.notifications.errors.captcha.missing)},$scope.hasErrorsCaptcha=function(){return!(!$scope.hasClientErrorsCaptcha()&&!$scope.hasServerErrorsCaptcha())},$scope.hasErrorsCaptchaOnBlur=function(){return!(!$scope.hasClientErrorsCaptchaOnBlur()&&!$scope.hasServerErrorsCaptcha())},$scope.hasFocus=function(fieldId){return $document[0].activeElement.id===fieldId},$scope.onlySignUp=$window.here.config.sdk&&$window.here.config.sdk.onlySignUp&&2<$window.here.config.sdk.version,$scope.isRealmInput=function(){if($window.here.config.sdk&&!0===$window.here.config.sdk.active)return!(!$window.here.config.sdk||!$window.here.config.sdk.realmInput);var lastLoginRealm=localstorage.getItem("lastLoginRealm");return!!(lastLoginRealm&&0<lastLoginRealm.length)&&($window.here.realm=lastLoginRealm,!0)},$scope.isSelfCertifyAge=function(){return!(!$window.here.config.sdk||!$window.here.config.sdk.selfCertifyAge)},$scope.isPhoneNumberField=function(){return!(!$window.here.config.sdk||!$window.here.config.sdk.phoneNumberField)},$scope.showCompanyEmailInSignUp=function(){return!(!$window.here.config.sdk||!$window.here.config.sdk.companyEmailInSignUp)},$scope.setCurrentCountry=function(){var countryCurrentIndex=$scope.user.getCountryKeyByCountryCode();0<=countryCurrentIndex&&countryCurrentIndex<$scope.user.countries.length?$scope.user.countryCurrent=$scope.user.countries[countryCurrentIndex]:$scope.user.countryCurrent={code:"USA",name:"United States of America"}},$scope.changeCountry=function(){return $scope.setTerms(),$scope.user.setCountryCode()},$scope.signOut=function(signOutUser,redirect){signOutUser&&redirect?$scope.user.signOut(function(){$window.location=redirect}):signOutUser?$scope.user.signOut(function(){$window.location="/"}):$window.location=redirect||"/"},$scope.goto=function(path,redirect,searchObject){var flow;$scope.user.restoreData(),"/sign-up"===path&&$scope.reloadCaptchaImage(),$scope.isSDK&&((flow=path.substr(1)).match(/^window/)?$scope.sdkCloseHide=!0:$scope.sdkMessage({flow:flow,action:"opened"})),redirect?$window.location=path:searchObject?(searchObject=_.extend($location.search(),searchObject),$location.path(path).search(searchObject)):$location.path(path)},$scope.gotoPageWithEmail=function(path){$scope.goto(path,!1,{email:encodeURIComponent($scope.user.dataTmp.email)})},$scope.gotoPageWithEmailAndOrgId=function(path){$scope.goto(path,!1,{email:encodeURIComponent($scope.user.dataTmp.email),realm:encodeURIComponent($scope.user.dataTmp.realm)})},$scope._handleRequest=function(params){var type=params.type||"create",method=params.method||"createUser",arrayData=params.arrayData||[],callbackSuccess=params.callbackSuccess||function(){},callbackError=params.callbackError||function(){},skipResetChange=params.skipResetChange||!1,skipClearPasswords=params.skipClearPasswords||!1;$scope.changings[type]||($scope.changings[type]=!0,$scope.unsetNotifications(),arrayData&&"function"==typeof arrayData?(callbackSuccess=angular.copy(arrayData),callbackError=angular.copy(callbackSuccess),arrayData=[]):arrayData&&"object"==typeof arrayData||(arrayData=[]),arrayData.push(function(err,data){var status=data&&data.status||500,errs=data&&data.errs||!1,hasErrors=!!(errs&&0<errs.length);skipClearPasswords||$scope.clearPasswords(),401!==status||hasErrors?419===status?($scope.goto("/sign-in"),$scope.account.flowRecovery=!0):401===status&&hasErrors&&errs[0]&&errs[0].errorCode&&(401e3===errs[0].errorCode||"401000"===errs[0].errorCode)?($scope.notifications.errors["changed"+$scope.capitalize(type)]=!0,$scope.changings[type]=!1):hasErrors?($scope.handleErrors(errs),$scope.changings[type]=!1):!0===err&&($scope.notifications.errors["changed"+$scope.capitalize(type)]=!0,$scope.changings[type]=!1):$scope.signOut(),skipResetChange||$scope.unsetChangings(),hasErrors||err||!callbackSuccess||"function"!=typeof callbackSuccess?(hasErrors||err)&&callbackError&&"function"==typeof callbackError&&callbackError(errs||!0):callbackSuccess(data)}),$scope.user[method].apply($scope.user,arrayData))},$scope.whichBrowser=function(){var key,userAgent=$window.navigator.userAgent,browsers={opera:/OPR/i,chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/msie|internet explorer/i};for(key in browsers)if(browsers[key].test(userAgent))return key;return"unknown"},$scope.captcha={},$scope.reloadCaptchaImage=function(){$scope.captcha.imageSrc="/api/captcha/250/30/000000?"+(new Date).getTime()},$scope.reloadCaptchaImage(),$scope.clearCaptchaText=function(){$scope.user.dataTmp.captcha=""},$scope.goToSignIn=function(){$scope.goto("/sign-in",!1)},$scope.goToConversionSignIn=function(){$scope.goto("/conversion-sign-in",!1)},$scope.goToSignUp=function(){$scope.goto("/sign-up",!1)},$scope.sdkUnloadEventHandler=function(){$scope.sdkAbort($window.here.page)},$scope.sdkMessage=function(data){var parent="frame"===$window.here.config.sdk.type?$window.parent:$window.opener;data.loggedIn&&!1===data.loggedIn&&(data={}),$window.here.config.sdk.uri&&parent.postMessage(data,decodeURIComponent($window.here.config.sdk.uri))},$scope.sdkAbort=function(flow){$window.removeEventListener("unload",$scope.sdkUnloadEventHandler),$location.path(),"/welcome"===$location.path()&&$scope.user.dataResponse&&$scope.sdkComplete(flow,$scope.user.dataResponse),"/reset-password-done"===$location.path()?$scope.sdkComplete(flow,{}):($scope.sdkMessage({flow:flow,action:"aborted"}),$scope.changings.loading=!1,$timeout(function(){$scope.goto("/window/done",!1)},100))},$scope.sdkComplete=function(flow,data){data=data||null,$window.removeEventListener("unload",$scope.sdkUnloadEventHandler),$scope.sdkMessage({flow:flow,action:"completed",data:data}),$scope.changings.loading=!1,$timeout(function(){$scope.goto("/window/done",!1)},100)},$scope.sdkOpened=function(flow){$scope.isSDK&&($scope.sdkMessage({flow:flow,action:"opened"}),$window.addEventListener("unload",$scope.sdkUnloadEventHandler,!1))},$scope.presetEmailAddr=function(){if($scope.isSDK){var prefillEmailAddr=$window.here.config.mfaEmailAddr;if(angular.isString(prefillEmailAddr)&&4<prefillEmailAddr.length)return prefillEmailAddr;prefillEmailAddr=$window.here.config.prefillEmailAddr;if(angular.isString(prefillEmailAddr)&&4<prefillEmailAddr.length)return prefillEmailAddr}return""},$scope.presetRealm=function(){if($scope.isSDK){var prefillRealm=$window.here.config.sdk.realm;if(angular.isString(prefillRealm)&&4<=prefillRealm.length)return prefillRealm}return""},$scope.isMfaEmailAddrPreset=function(){var mfaEmailAddr=$window.here.config.mfaEmailAddr;return!!($scope.isSDK&&angular.isString(mfaEmailAddr)&&4<mfaEmailAddr.length)&&($scope.user.dataTmp.email=mfaEmailAddr,!0)},$scope.triggerMFARqdFlow=function(mfaClientIdArray){$scope._handleRequest({type:"setMFARequired",method:"setMFARequiredForClientId",arrayData:[mfaClientIdArray],callbackSuccess:function(data){$scope.user.getMFAChannels(function(status,channelData){channelData.channels&&0<channelData.channels.length?$scope.sdkComplete($scope.user.dataTmp.mfaLoggedInState,$scope.user.dataResponse):$location.path("/channels")})},callbackError:function(errs){NotificationService.showNotification("error",$window.here.notifications.unhandledError)}})};var bodyColor=2,bodyClasses=["membrane--brand","membrane--dark","membrane--light"];$scope.colorClick=function(evt){bodyColor=2===bodyColor?0:bodyColor+1,_.each(bodyClasses,function(c){document.body.classList.remove(c)}),document.body.classList.add(bodyClasses[bodyColor])},$scope.closeCookieNotice=function(){if(document.getElementById("cookie-notice")){document.body.classList.remove("cookie-notice"),document.getElementById("cookie-notice").style.display="none";try{localstorage.setItem("hideCookieWarning",!0)}catch(err){}}},!$scope.isSDK&&document.getElementById("cookie-notice")&&"true"!==localstorage.getItem("hideCookieWarning")&&(document.body.classList.add("cookie-notice"),document.getElementById("cookie-notice").style.display="flex"),$scope.selectedLang={code:""},$scope.languageList=$window.here&&$window.here.car?DataService.getCarLanguagesList():DataService.getLanguagesList(),$scope.changeLanguage=function(){window.location.href=CommonService.updateUrlParameter(window.location.href,"lang",$scope.selectedLang.code)},$scope.inputLanguageCode=CommonService.getQueryString("lang")||CommonService.getQueryString("language")||CommonService.getCookie("locale")||"en-GB",$scope.selectedLang.code=DataService.getValidLanguageCode($scope.inputLanguageCode,$scope.languageList),$scope.selectedLang.code||($scope.selectedLang.code="en-GB",$scope.changeLanguage()),CommonService.initPasswordStrength()}),angular.module("hereApp.account").controller("AccountSignInPageCtrl",function($rootScope,$scope,$location,$window,$cookies,$timeout,$document,TrackingService,CountryService,TranslationService,FormValidator,FormValidatorSelfServe,DataService,CommonService,AppEnums){"use strict";var signInWithAuthFed,trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"",localstorage=window.localStorage;$scope.esriId=null,$scope.faqLink=$window.here.config.faqLink,$scope.noFB=$window.here.config.sdk&&$window.here.config.sdk.noFB&&$window.here.config.sdk.version<2,$scope.noSignUp=$window.here.config.sdk&&$window.here.config.sdk.noSignUp&&2<$window.here.config.sdk.version,$scope.formSignInWelcomeInfo=!0,$scope.data=DataService.getDobData(),$scope.isInviteTokenValid=CommonService.isInviteTokenValid,$scope.isConversionSignIn="/conversion-sign-in"===$location.path(),$scope.isMarketingEmailEnabled=$window.here.features.enableMarketingEmail,$scope.isConversionSignInEnabled=$window.here.features.enableConversionSignIn,$scope.flow=AppEnums.flow.SIGN_IN,$scope.action="",$scope.clearDoBHelp=function(){FormValidator.untrigger(document.getElementById("user-date-of-birth-help"))},$scope.triggerDoBHelp=function(){TranslationService.get("hereacc.web.signup.help.dob",function(val){FormValidator.trigger(document.getElementById("user-date-of-birth-help"),val)})},$scope.changings={loadingRealm:!1,loadingNextBtn:!1};var _esriInfo=null,_arcgisPortal=null,_authFederations_facebook="facebook",_authFederations_google="google",_authFederations_arcgis="arcgis",_authFederations_heread="heread",_authFederations_verimi="verimi",_lastAuthFedRealm=localstorage.getItem("account.oauthFederationRealm"),_lastAuthFedChosen=localstorage.getItem("account.oauthFederation");$scope.registerViaArcGis=function(){$timeout(function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with ArcGis account","",null),$scope.esriId.getCredential(_esriInfo.portalUrl+"/sharing",{oAuthPopupConfirmation:!1}).then(function(){$scope.$parent.changings.loading=!0,new _arcgisPortal.Portal(_esriInfo.portalUrl).signIn().then(function(portalUser){portalUser.region&&($scope.user.dataTmp.authFed.countryCode=CountryService.getByTwoLettersCode(portalUser.region.toUpperCase())),localstorage.removeItem("account.facebook.rerequest"),$scope.user.dataTmp.authFed.token=portalUser.credential.token,signInWithAuthFed(_authFederations_arcgis)}).otherwise(function(error){$scope.$parent.changings.loading=!1})})})},$scope.registerViaVerimi=function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with Verimi","",null);var state=function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<25;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}();localstorage.setItem("verimi-state",state);var config=$window.here.config.verimi,r2fa=$window.here.require2fa?"&acr_values=loa.dipp.2fa":"";window.open(config.loginPage+"/dipp/api/oauth2/auth?state="+state+r2fa+"&response_type=code&approval_prompt=auto&client_id="+config.clientId+"&data=&scope=login+openid+offline+name+email&redirect_uri="+encodeURIComponent(config.redirectUri))};var initGoogle=function(){$scope.googleApi&&$scope.googleApi.client?handleGoogleClientLoad():window.setTimeout(initGoogle,1)},handleGoogleClientLoad=function(){$scope.googleApi.client.setApiKey($window.here.config.google.apiKey),window.setTimeout(enableGoogleAuthButton,1)},enableGoogleAuthButton=function(){var authorizeButton=document.getElementById("sign-in-google");authorizeButton.style.visibility="",authorizeButton.onclick=handleGoogleAuthClick},handleGoogleAuthClick=function(event){return $scope.googleApi.auth.authorize({client_id:$window.here.config.google.appId,scope:"profile email",immediate:!1},handleGoogleAuthResult),!1},handleGoogleAuthResult=function(authResult){$scope.user.dataTmp.authFed.token=authResult.access_token;var authorizeButton=document.getElementById("sign-in-google");authResult&&!authResult.error?(authorizeButton.style.visibility="hidden",getGoogleUserData()):enableGoogleAuthButton()},getGoogleUserData=function(){$scope.googleApi.client.setApiKey(""),$scope.googleApi.client.load("plus","v1").then(function(response){$scope.googleApi.client.plus.people.get({userId:"me"}).then(function(resp){$scope.user.dataTmp.authFed.countryCode="",$scope.user.dataTmp.authFed.email=resp.result.emails[0].value,$scope.user.dataTmp.authFed.language="",signInWithAuthFed(_authFederations_google)},function(reason){})},function(reason){})};$scope.registerViaHereAD=function(){$timeout(function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with HERE AD account","",null),$window.here.config.env&&"local"===$window.here.config.env?window.open("http://localhost:3000/saml/test-call-back"):-1<$window.here.config.heread.loginPage.indexOf("okta.com")?window.open($window.here.config.heread.loginPage):window.open($window.here.config.heread.loginPage+"?loginToRP=https://"+window.location.hostname)})},$scope.signInWithSAMLToken=function(token){$scope.user.dataTmp.authFed.token=token,signInWithAuthFed(_authFederations_heread)},$window.onSAMLCallBack=function(token){$scope.signInWithSAMLToken(token)},$scope.signInWithVerimi=function(verimiAuthParams){$scope.user.dataTmp.authFed.code=verimiAuthParams,$scope.$parent.changings.loading=!0;verimiAuthParams={redirectUri:decodeURIComponent($window.here.config.verimi.redirectUri),code:$scope.user.dataTmp.authFed.code,language:$scope.user.dataTmp.authFed.language};$scope.user.getVerimiAccessToken(verimiAuthParams,function(response){signInWithAuthFed(_authFederations_verimi)})},$window.onVerimiCallBack=function(code){$scope.signInWithVerimi(code)},$scope.refreshFederation=function(){var federation=$window.here.federation;console.log("refreshFederation: "+federation),"heread"===federation?$scope.registerViaHereAD():"verimi"===federation&&$scope.registerViaVerimi()},$scope.dividerRequired=function(){return $scope.isSignInMethodAvailable("password")&&1<$window.here.config.signInScreenConfig.length},$scope.flipPwVisibility=function(){$scope.showPassword=!$scope.showPassword,$scope.$parent.focusPwInput($scope.showPassword?"sign-in-password-readable":"sign-in-password-encrypted")},$scope.setWarning=function(target,msg,_prefix){TranslationService.get(("general"===msg||"general"===_prefix?"hereacc.web.error":"hereacc.web.signin.error")+"."+msg,function(val){var element=document.getElementById(target);element?($scope.isConversionSignIn?FormValidatorSelfServe:FormValidator).trigger(element,val):CommonService.createErrorBox(val)})},$scope.isSignInMethodAvailable=function(signInOption){var restrictedLoginArr=$window.here.config.sdk.restrictedLogin||$window.here.config.signInScreenConfig;return!(!angular.isArray(restrictedLoginArr)||-1===restrictedLoginArr.indexOf(signInOption))&&("password"!==signInOption||!$scope.isSDK||!$scope.onlySignUp)},$scope.isSignUpAvailable=function(){return!($scope.isSDK&&$scope.noSignUp)},$scope.goToHelpFAQ=function(type){return trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"account FAQ opened from sign in "+("manual"===type?"error message":"FB flow")),!0},$scope.user.dataTmp.init||($scope.user.dataTmp={init:!0,email:localstorage.getItem("rememberLoginValue")||"",password:"",realm:localstorage.getItem("lastLoginRealm")||"",rememberMe:$window.here.features.rememberMeByDefault,terms:{token:"",termsURL:"",privacyURL:""},dobRequired:{token:""},marketingConsent:!1,termsToken:"",missing:{countryCode:!1,email:!1},authFed:{code:null,token:null,email:null,countryCode:null,language:$window.here.user.locale.language,me:null}},$scope.isConversionSignInEnabled&&$scope.isConversionSignIn&&($scope.user.dataTmp.email="")),$scope.privacyURL=$scope.user.dataTmp.terms.privacyURL,$scope.termsURL=$scope.user.dataTmp.terms.termsURL,$scope.prodTermsURL=$scope.user.dataTmp.terms.prodTermsURL,$scope.errors={},$scope.$parent.changings.loading=!1,$scope.showPassword=!1,$scope.countries=$window.here.countries,$scope.facebookApi=$window.FB,$scope.googleApi=$window.gapi,$scope.firstName="",$scope.lastName="",$scope.userEmail="",$scope.authFedUpdateMe=function(){$scope.user.dataTmp.authFed.me&&($scope.firstName=$scope.user.dataTmp.authFed.me.first_name,$scope.lastName=$scope.user.dataTmp.authFed.me.last_name,$scope.user.dataTmp.authFed.me.email&&($scope.userEmail=$scope.user.dataTmp.authFed.me.email,$scope.user.dataTmp.authFed.email=$scope.user.dataTmp.authFed.me.email))},$scope.authFedUpdateMe(),$scope.signInDone=function(qstr){localstorage.removeItem("account.oauthFederation"),localstorage.removeItem("account.oauthFederationRealm");var mfaClientIdArray=$location.search().authorizeUri;null!=(mfaClientIdArray=mfaClientIdArray||$scope.authorizeUri)&&0<mfaClientIdArray.length?$window.location=mfaClientIdArray:$scope.isSDK?(mfaClientIdArray=$window.here.config.mfaClientIdArray)?($scope.user.dataResponse=qstr,$scope.user.dataTmp.mfaLoggedInState="sign-in-with-set-mfa",$scope.triggerMFARqdFlow(mfaClientIdArray)):$scope.isConversionSignIn?(window.sessionStorage.removeItem("esriJSAPIOAuth"),$scope.$parent.changings.loading=!1,$scope.sdkConversionSignInComplete(qstr)):$scope.sdkComplete("sign-in",qstr):(qstr=qstr.realm&&"here"!==qstr.realm.toLowerCase()?"?realm="+qstr.realm:"",$window.location="/"+qstr)},$scope.sdkConversionSignInComplete=function(data){$scope.sdkMessage({flow:$scope.flow,action:$scope.action,data:data})},$scope.$watch("user.dataTmp.email",function(){"/sign-in"===$location.path()&&$timeout(function(){var encryptedPassword=$document[0].getElementById("sign-in-password-encrypted");$scope.user.dataTmp.password=$scope.user.dataTmp.password||(encryptedPassword?encryptedPassword.value:"")},100)}),$scope.$watch("user.dataTmp.authFed.countryCode",function(newVal){$scope.user.dataTmp.termsAccepted=newVal&&$window.here.config.explicitTermsCountries.indexOf(newVal)<0,newVal&&($scope.user.countryCurrent.code=$scope.user.dataTmp.authFed.countryCode,$scope.changeCountry(),$scope.setTerms())}),$scope.abortReAcceptTerms=function(){$location.path("/sign-in")},$scope.welcomeValid=function(){var result=!0;return $scope.user.dataTmp.missing.email&&(result=result&&$scope.user.validateEmail($scope.user.dataTmp.authFed.email)),$scope.user.dataTmp.missing.countryCode&&(result=result&&null!==$scope.user.dataTmp.authFed.countryCode),result=$scope.inExplicitTermsCountry()?result&&$scope.user.dataTmp.termsAccepted:result},$scope.inExplicitTermsCountry=function(){return""!==$scope.user.dataTmp.authFed.countryCode&&-1<$window.here.config.explicitTermsCountries.indexOf($scope.user.dataTmp.authFed.countryCode)},$scope.signInWithLastAuthFed=function(){_authFederations_facebook===_lastAuthFedChosen||_authFederations_arcgis===_lastAuthFedChosen||_authFederations_google===_lastAuthFedChosen||_authFederations_heread===_lastAuthFedChosen||_authFederations_verimi===_lastAuthFedChosen?($scope.user.dataTmp.realm=_lastAuthFedRealm,signInWithAuthFed(_lastAuthFedChosen)):new Error("No Auth Federation chosen")},$scope.acceptTerms=function(){$scope.user.acceptTermsWithToken({token:$scope.user.dataTmp.terms.token},function(err){err?($scope.errors.server=!0,console.log("acceptTermsWithToken Error: "+err),$scope.setWarning("sign-in-email","general")):($scope.isConversionSignInEnabled&&$scope.setConversionSignIn(),$scope.user.dataTmp.authFed.token||$scope.user.dataTmp.authFed.code?$scope.signInWithLastAuthFed():$scope.signIn()),$scope.user.dataTmp.termsAccepted=!1})},$scope.validateDobRequiredForm=function(){FormValidator.validate()&&$scope.saveDobRequired()},$scope.saveDobRequired=function(){$scope.$parent.changings.loading=!0,$scope.user.saveDobRequiredWithToken({token:$scope.user.dataTmp.dobRequired.token},function(err){err?($scope.errors.server=!0,$scope.$parent.changings.loading=!1,console.log("saveDobRequiredWithToken Error: "+err),$scope.setWarning("user-date-of-birth-help","general")):($scope.isConversionSignInEnabled&&$scope.setConversionSignIn(),$scope.signIn())})},$scope.setConversionSignIn=function(){$location.search().flow===AppEnums.flow.CONVERSION_SIGN_IN&&($scope.isConversionSignIn=!0,$scope.flow=AppEnums.flow.CONVERSION_SIGN_IN,$scope.action=AppEnums.messageType.CONVERSION_SIGN_IN_SUCCESS)},signInWithAuthFed=function(authFedName){var realm=$scope.user.dataTmp.realm||($window.here.config.sdk?$window.here.config.sdk.realm:"here");try{localstorage.setItem("account.oauthFederation",authFedName),localstorage.setItem("account.oauthFederationRealm",realm),document.getElementById("realm-input")&&"here"!==(realm=document.getElementById("realm-input").value).toLowerCase()&&localstorage.setItem("lastLoginRealm",realm)}catch(e){}$scope.$parent.changings.loading=!0,$scope.user.dataTmp.authFed.countryCode&&$scope.user.dataTmp.missing.countryCode&&($scope.user.dataTmp.missing.countryCode=!1),$scope.user.dataTmp.authFed.email&&$scope.user.dataTmp.missing.email&&($scope.user.dataTmp.missing.email=!1);var authParams={accessToken:$scope.user.dataTmp.authFed.token,realm:realm,countryCode:$scope.user.dataTmp.authFed.countryCode,email:$scope.user.dataTmp.authFed.email,language:$scope.user.dataTmp.authFed.language,isConversionSignIn:$scope.isConversionSignIn,rememberMe:$window.here.features.rememberMeByDefault};authFedName===_authFederations_verimi&&(authParams={redirectUri:decodeURIComponent($window.here.config.verimi.redirectUri),realm:realm,language:$scope.user.dataTmp.authFed.language,accessToken:$scope.user.dataTmp.authFed.accessToken,idToken:$scope.user.dataTmp.authFed.idToken,userId:$scope.user.dataTmp.authFed.userId,expiresIn:$scope.user.dataTmp.authFed.expiresIn,isConversionSignIn:$scope.isConversionSignIn}),$scope.user.signInWithAuthFederation(authFedName,authParams,function(err,status){err=err||!1;if(console.log("status: "+status),err||201===status)if(400===status&&400200===err.errorCode)"countryCode"===err.errorFields[0].name&&($scope.user.dataTmp.missing.countryCode=!0,$scope.user.dataTmp.authFed.countryCode=null,$scope.$parent.changings.loading=!1,$scope.isConversionSignInEnabled?$location.path("/welcome-auth").search({flow:$scope.flow}):$location.path("/welcome-auth"));else if(400===status&&400800===err.errorCode)$scope.user.dataTmp.missing.email=!0,$scope.user.dataTmp.missing.countryCode=!0,$scope.$parent.changings.loading=!1,$scope.isConversionSignInEnabled?$location.path("/welcome-auth").search({flow:$scope.flow}):$location.path("/welcome-auth");else if(400===err.httpStatus&&401111===err.errorCode)$scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"email.mismatch");else if(401===status&&401304===err.errorCode){$scope.$parent.changings.loading=!1,$scope.errors.emailPermission=!0,$scope.setWarning("sign-in-"+authFedName,"facebookEmail");try{localstorage.setItem("account.facebook.rerequest",!0)}catch(e){}}else 401===err.httpStatus&&401500===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"disabled.account")):401===err.httpStatus&&401911===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),console.log("signInWithAuthFederation error with SAML token: status="+status+", err: "+err+", errCode: "+err.errorCode+", message: "+err.message)):412!==status||412001!==err.errorCode&&412002!==err.errorCode?400255===err.errorCode||412306===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,console.log("error caught: status="+status+", err: "+err+", errCode: "+err.errorCode),412306===err.errorCode?$scope.setWarning("realm-input","inviteToken.required","general"):$scope.setWarning("realm-input","invalid.realm"),$scope.isConversionSignInEnabled?$location.path("/"+$scope.flow):$location.path("/sign-in")):201===status?($scope.signInWithLastAuthFed(),trackingEnabled&&($scope.isConversionSignInEnabled?TrackingService.track($scope.flow,SDKTrackingPrefix+"successful sign-up with "+authFedName,"","event21"):TrackingService.track("sign-in",SDKTrackingPrefix+"successful sign-up with "+authFedName,"","event21"))):($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),console.log("signInWithAuthFederation error not handled: status="+status+", err: "+err+", errCode: "+err.errorCode)):($scope.user.dataTmp.terms.token=err.termsReacceptanceToken,$scope.user.dataTmp.terms.termsURL=err.url.tos,$scope.user.dataTmp.terms.privacyURL=err.url.pp,$scope.user.dataTmp.terms.prodTermsURL="https://legal.here.com/terms/here-platform",$scope.user.dataTmp.termsAccepted?$scope.acceptTerms():($scope.$parent.changings.loading=!1,$scope.user.dataTmp.termsAccepted=!1,$scope.isConversionSignInEnabled?$location.path("/terms").search({flow:$scope.flow}):$location.path("/terms")));else $scope.user.dataTmp.marketingConsent?$scope.user.updateMarketing(!0,function(err,data){err?($scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),$scope.$parent.changings.loading=!1):($scope.signInDone(data),trackingEnabled&&($scope.isConversionSignInEnabled?TrackingService.track($scope.flow,SDKTrackingPrefix+"successful signin with "+authFedName,"","event17"):TrackingService.track("sign-in",SDKTrackingPrefix+"successful signin with "+authFedName,"","event17")))}):($scope.signInDone(status),trackingEnabled&&($scope.isConversionSignInEnabled?TrackingService.track($scope.flow,SDKTrackingPrefix+"successful signin with "+authFedName,"","event17"):TrackingService.track("sign-in",SDKTrackingPrefix+"successful signin with "+authFedName,"","event17")))})},$scope.signInWithArcGis=function(){signInWithAuthFed(_authFederations_arcgis)},$scope.signInWithFacebook=function(){signInWithAuthFed(_authFederations_facebook)},$scope.signInWithGoogle=function(){signInWithAuthFed(_authFederations_google)},$scope.registerViaFacebook=function(requestOptions){requestOptions={scope:requestOptions||"email,public_profile"};localstorage.getItem("account.facebook.rerequest")&&(requestOptions.auth_type="rerequest"),$scope.facebookApi.init({appId:$window.here.config.facebook.appId,status:$window.here.config.facebook.status,xfbml:$window.here.config.facebook.xfbml,version:"v2.12"}),trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with Facebook account","",null),$scope.facebookApi.login(function(loginResponse){loginResponse&&loginResponse.authResponse&&(localstorage.removeItem("account.facebook.rerequest"),$scope.user.dataTmp.authFed.token=loginResponse.authResponse.accessToken,$scope.facebookApi.api("/me",function(response){$scope.user.dataTmp.authFed.me=response,$scope.authFedUpdateMe(),signInWithAuthFed(_authFederations_facebook)}))},requestOptions)},$scope.trackClick=function(msg){trackingEnabled&&TrackingService.click(SDKTrackingPrefix+msg)},$scope.validateForm=function(){$scope.isConversionSignIn?FormValidatorSelfServe.validate()&&$scope.signIn():FormValidator.validate()&&$scope.signIn()},$scope.isAllowedLoginForRealm={facebook:!1,verimi:!1,google:!1,arcgis:!1,heread:!1,password:!1};var setAllowedLoginsBasedOnConfig=function(){for(var key in $scope.isAllowedLoginForRealm)$scope.isAllowedLoginForRealm[key]=$scope.isSignInMethodAvailable(key)};$scope.dividerRequiredWithRealm=function(){return $scope.isAllowedLoginForRealm.password&&($scope.isAllowedLoginForRealm.heread||$scope.isAllowedLoginForRealm.arcgis||$scope.isAllowedLoginForRealm.facebook||$scope.isAllowedLoginForRealm.verimi||$scope.isAllowedLoginForRealm.google)};$scope.validateRealm=function(isNextBtnVisisble){$scope.changings.loadingRealm=!isNextBtnVisisble,$scope.changings.loadingNextBtn=!!isNextBtnVisisble,DataService.getRealmInfo($scope.user.dataTmp.realm,function(allowedLogins){var realmDetails=allowedLogins.data||{},isOlpPortal=$window.here.config.sdk&&$window.here.config.sdk.isOlpClient;realmDetails&&realmDetails.allowedLogins?!isOlpPortal||"here"!==realmDetails.id.toLowerCase()&&"olp"==realmDetails.realmType?(allowedLogins=realmDetails.allowedLogins,$scope.isAllowedLoginForRealm.password=-1!==_.findIndex(allowedLogins,{method:"password"}),$scope.isAllowedLoginForRealm.heread=-1!==_.findIndex(allowedLogins,{method:"saml"}),$scope.showRealmNextbtn=!1):$scope.setWarning("realm-input","invalid.realm"):realmDetails&&realmDetails.id&&(!isOlpPortal||"here"!==realmDetails.id.toLowerCase()&&"olp"==realmDetails.realmType)?(setAllowedLoginsBasedOnConfig(),$scope.showRealmNextbtn=!1):$scope.setWarning("realm-input","invalid.realm"),$scope.changings.loadingRealm=!1,$scope.changings.loadingNextBtn=!1})},$scope.isOlpRealm=function(){return $window.here.olpRealm};$scope.signIn=function(){$scope.isConversionSignIn?($scope.user.dataTmp.isConversionSignIn=!0,$scope.user.dataTmp.realm="here"):function(){if(document.getElementById("sign-in-remember-me")&&document.getElementById("sign-in-remember-me").checked)try{var realm;localstorage.setItem("rememberLoginValue",document.getElementById("sign-in-email").value),!document.getElementById("realm-input")||"here"!==(realm=document.getElementById("realm-input").value).toLowerCase()&&localstorage.setItem("lastLoginRealm",realm)}catch(e){}else localstorage.removeItem("rememberLoginValue"),localstorage.removeItem("lastLoginRealm")}(),$scope.errors={},$scope.$parent.changings.loading=!0,$scope.user.dataTmp.realm||($scope.user.dataTmp.realm=$window.here.realm),$scope.user.signInWithPassword($scope.user.dataTmp,function(err,data){err?(401===err.httpStatus&&401410===err.errorCode?($scope.errors.locked=!0,$scope.setWarning("sign-in-email","locked.account")):401===err.httpStatus&&401500===err.errorCode?($scope.setWarning("sign-in-email","disabled.account"),$scope.errors.credentials=!0):401===err.httpStatus&&401601===err.errorCode?($scope.setWarning("sign-in-email","resend.invite"),$scope.errors.credentials=!0):data&&data.status&&401===data.status&&401010===err.errorCode?$scope.isConversionSignIn?($scope.errors.server=!0,$scope.setWarning("sign-in-email","general")):($scope.user.dataTmp.mfaLoggedInState="sign-in",$scope.user.dataTmp.mfaAllChannels=err.channels||[],$location.path("/channels")):401===err.httpStatus?($scope.setWarning("sign-in-email","invalid.credentials"),$scope.errors.credentials=!0):412002===err.errorCode||412001===err.errorCode?($scope.user.dataTmp.terms.token=err.termsReacceptanceToken,$scope.user.dataTmp.terms.termsURL=err.url.tos,$scope.user.dataTmp.terms.privacyURL=err.url.pp,$scope.user.dataTmp.terms.prodTermsURL="https://legal.here.com/terms/here-platform",$scope.isConversionSignInEnabled?$location.path("/terms").search({flow:$scope.flow}):$location.path("/terms")):412003===err.errorCode?($scope.user.dataTmp.dobRequired.token=err.dobRequiredToken,$scope.isConversionSignInEnabled?$location.path("/dob-required").search({flow:$scope.flow}):$location.path("/dob-required")):400255===err.errorCode?($scope.errors.server=!0,$scope.setWarning("realm-input","invalid.realm")):($scope.errors.server=!0,$scope.setWarning("sign-in-email","general")),$scope.$parent.changings.loading=!1):($scope.signInDone(data),trackingEnabled&&($scope.isConversionSignInEnabled?TrackingService.track($scope.flow,SDKTrackingPrefix+"successful signin","","event17"):TrackingService.track("sign-in",SDKTrackingPrefix+"successful signin","","event17")))})},function(){if($scope.isConversionSignIn&&($scope.flow=AppEnums.flow.CONVERSION_SIGN_IN,$scope.action=AppEnums.messageType.CONVERSION_SIGN_IN_SUCCESS),$scope.isSDK&&$window.here.config.sdk.decodedInviteToken&&$window.here.config.sdk.decodedInviteToken.errorCode)$scope.sdkMessage({flow:"sign-in",action:"aborted",data:$window.here.config.sdk.decodedInviteToken.errorCode});else{if(trackingEnabled){var presetEmailAddr=$location.search()["client-id"]?$location.search()["client-id"]:null,additionalTrackingParam={};switch($scope.isSDK&&presetEmailAddr&&(additionalTrackingParam.prop55=presetEmailAddr,additionalTrackingParam.eVar55=presetEmailAddr),$location.path()){case"/sign-in":TrackingService.track("sign-in",SDKTrackingPrefix+"signin attempt",additionalTrackingParam,null);break;case"/conversion-sign-in":TrackingService.track("conversion-sign-in",SDKTrackingPrefix+"conversion signin attempt",additionalTrackingParam,null);break;case"/sign-in-mob":TrackingService.track("sign-in-mob",SDKTrackingPrefix+"signin attempt from mobile",additionalTrackingParam,null);break;case"/welcome-auth":TrackingService.track("welcome-auth",SDKTrackingPrefix+"welcome page after "+_lastAuthFedChosen+" sign-up",additionalTrackingParam,null);break;case"/terms":TrackingService.track("terms",SDKTrackingPrefix+"signin accept terms",additionalTrackingParam,null);break;case"/dob-required":TrackingService.track("dob-required",SDKTrackingPrefix+"signin dob required",additionalTrackingParam,null);break;default:TrackingService.track("sign-in",SDKTrackingPrefix+"signin attempt",additionalTrackingParam,null)}}"/sign-in"!==$location.path()&&!$scope.isConversionSignIn||($scope.isSignInMethodAvailable("arcgis")&&$timeout(function(){$window.require(["esri/arcgis/Portal","esri/arcgis/OAuthInfo","esri/IdentityManager","dojo/domReady!"],function(arcgisPortal,OAuthInfo,esriId){$scope.esriId=esriId,_arcgisPortal=arcgisPortal,_esriInfo=new OAuthInfo({appId:$window.here.config.esri.appId,popupCallbackUrl:"/arcgis/oauth-callback",popup:!0}),$scope.esriId.registerOAuthInfos([_esriInfo]),$scope.$apply()})}),$scope.isSignInMethodAvailable("google")&&initGoogle()),$scope.isSDK&&(0<(presetEmailAddr=$scope.presetEmailAddr()||"").length&&($scope.user.dataTmp.email=presetEmailAddr),$scope.user.dataTmp.realm=$scope.presetRealm()),FormValidator.init(),$scope.isConversionSignIn&&FormValidatorSelfServe.init()}$scope.authorizeUri=$location.search().authorizeUri,$scope.isRealmInput()?$scope.$watch("user.dataTmp.realm",function(newVal,oldVal){for(var key in $scope.showRealmNextbtn=!0,$scope.isAllowedLoginForRealm)$scope.isAllowedLoginForRealm[key]=!1;FormValidator.untrigger(document.getElementById("realm-input")),""!==newVal&&newVal===oldVal&&$scope.validateRealm()}):setAllowedLoginsBasedOnConfig()}()}),angular.module("hereApp.account").controller("AccountSignInPageOlpCtrl",function($rootScope,$scope,$location,$window,$cookies,$timeout,$document,TrackingService,CountryService,TranslationService,FormValidator,DataService,CommonService){"use strict";var signInWithAuthFed,trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"",localstorage=window.localStorage;$scope.esriId=null,$scope.faqLink=$window.here.config.faqLink,$scope.noFB=$window.here.config.sdk&&$window.here.config.sdk.noFB&&$window.here.config.sdk.version<2,$scope.noSignUp=$window.here.config.sdk&&$window.here.config.sdk.noSignUp&&2<$window.here.config.sdk.version,$scope.platformSignUpUrl=$window.here.config.platformClm.signUp,$scope.formSignInWelcomeInfo=!0,$scope.data=DataService.getDobData(),$scope.isInviteTokenValid=CommonService.isInviteTokenValid,$scope.isSelfServeSignUpEnabled=$window.here.features.enableNoPlatformAccountMsg,$scope.isPlatformTermsReAcceptanceEnabled=$window.here.features.enablePlatformTermsReAcceptance,$scope.clearDoBHelp=function(){FormValidator.untrigger(document.getElementById("user-date-of-birth-help"))},$scope.triggerDoBHelp=function(){TranslationService.get("hereacc.web.signup.help.dob",function(val){FormValidator.trigger(document.getElementById("user-date-of-birth-help"),val)})},$scope.changings={loadingEmailNextBtn:!1,loadingRealmNextBtn:!1,loadingPlatformTerms:!1};var _esriInfo=null,_arcgisPortal=null,_authFederations_facebook$0="facebook",_authFederations_google$0="google",_authFederations_arcgis$0="arcgis",_authFederations_heread$0="heread",_authFederations_verimi$0="verimi",_lastAuthFedRealm=localstorage.getItem("account.oauthFederationRealm"),_lastAuthFedChosen=localstorage.getItem("account.oauthFederation");$scope.registerViaArcGis=function(){$timeout(function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with ArcGis account","",null),$scope.esriId.getCredential(_esriInfo.portalUrl+"/sharing",{oAuthPopupConfirmation:!1}).then(function(){$scope.$parent.changings.loading=!0,new _arcgisPortal.Portal(_esriInfo.portalUrl).signIn().then(function(portalUser){portalUser.region&&($scope.user.dataTmp.authFed.countryCode=CountryService.getByTwoLettersCode(portalUser.region.toUpperCase())),localstorage.removeItem("account.facebook.rerequest"),$scope.user.dataTmp.authFed.token=portalUser.credential.token,signInWithAuthFed(_authFederations_arcgis$0)}).otherwise(function(error){$scope.$parent.changings.loading=!1})})})},$scope.registerViaVerimi=function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with Verimi","",null);var state=function(){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<25;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}();localstorage.setItem("verimi-state",state);var config=$window.here.config.verimi,r2fa=$window.here.require2fa?"&acr_values=loa.dipp.2fa":"";window.open(config.loginPage+"/dipp/api/oauth2/auth?state="+state+r2fa+"&response_type=code&approval_prompt=auto&client_id="+config.clientId+"&data=&scope=login+openid+offline+name+email&redirect_uri="+encodeURIComponent(config.redirectUri))};var initGoogle=function(){$scope.googleApi&&$scope.googleApi.client?handleGoogleClientLoad():window.setTimeout(initGoogle,1)},handleGoogleClientLoad=function(){$scope.googleApi.client.setApiKey($window.here.config.google.apiKey),window.setTimeout(enableGoogleAuthButton,1)},enableGoogleAuthButton=function(){var authorizeButton=document.getElementById("sign-in-google");authorizeButton.style.visibility="",authorizeButton.onclick=handleGoogleAuthClick},handleGoogleAuthClick=function(event){return $scope.googleApi.auth.authorize({client_id:$window.here.config.google.appId,scope:"profile email",immediate:!1},handleGoogleAuthResult),!1},handleGoogleAuthResult=function(authResult){$scope.user.dataTmp.authFed.token=authResult.access_token;var authorizeButton=document.getElementById("sign-in-google");authResult&&!authResult.error?(authorizeButton.style.visibility="hidden",getGoogleUserData()):enableGoogleAuthButton()},getGoogleUserData=function(){$scope.googleApi.client.setApiKey(""),$scope.googleApi.client.load("plus","v1").then(function(response){$scope.googleApi.client.plus.people.get({userId:"me"}).then(function(resp){$scope.user.dataTmp.authFed.countryCode="",$scope.user.dataTmp.authFed.email=resp.result.emails[0].value,$scope.user.dataTmp.authFed.language="",signInWithAuthFed(_authFederations_google$0)},function(reason){})},function(reason){})};$scope.registerViaHereAD=function(){$timeout(function(){trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with HERE AD account","",null),$window.here.config.env&&"local"===$window.here.config.env?window.open("http://localhost:3000/saml/test-call-back"):-1<$window.here.config.heread.loginPage.indexOf("okta.com")?window.open($window.here.config.heread.loginPage):window.open($window.here.config.heread.loginPage+"?loginToRP=https://"+window.location.hostname)})},$scope.signInWithSAMLToken=function(token){$scope.user.dataTmp.authFed.token=token,signInWithAuthFed(_authFederations_heread$0)},$window.onSAMLCallBack=function(token){$scope.signInWithSAMLToken(token)},$scope.signInWithVerimi=function(verimiAuthParams){$scope.user.dataTmp.authFed.code=verimiAuthParams,$scope.$parent.changings.loading=!0;verimiAuthParams={redirectUri:decodeURIComponent($window.here.config.verimi.redirectUri),code:$scope.user.dataTmp.authFed.code,language:$scope.user.dataTmp.authFed.language};$scope.user.getVerimiAccessToken(verimiAuthParams,function(response){signInWithAuthFed(_authFederations_verimi$0)})},$window.onVerimiCallBack=function(code){$scope.signInWithVerimi(code)},$scope.refreshFederation=function(){var federation=$window.here.federation;console.log("refreshFederation: "+federation),"heread"===federation?$scope.registerViaHereAD():"verimi"===federation&&$scope.registerViaVerimi()},$scope.focusElement=function(elId,delay){$timeout(function(){var element=$document[0].getElementById(elId);element&&element.focus()},delay=delay||100)},$scope.dividerRequired=function(){return $scope.isSignInMethodAvailable("password")&&1<$window.here.config.signInScreenConfig.length},$scope.flipPwVisibility=function(){$scope.showPassword=!$scope.showPassword,$scope.focusElement($scope.showPassword?"sign-in-password-readable":"sign-in-password-encrypted",250)},$scope.setWarning=function(target,msg,_prefix){TranslationService.get(("general"===msg||"general"===_prefix?"hereacc.web.error":"hereacc.web.signin.error")+"."+msg,function(val){var element=document.getElementById(target);element?FormValidator.trigger(element,val):CommonService.createErrorBox(val)})},$scope.isSignInMethodAvailable=function(signInOption){var restrictedLoginArr=$window.here.config.sdk.restrictedLogin||$window.here.config.signInScreenConfig;return!(!angular.isArray(restrictedLoginArr)||-1===restrictedLoginArr.indexOf(signInOption))&&("password"!==signInOption||!$scope.isSDK||!$scope.onlySignUp)},$scope.isSignUpAvailable=function(){return!($scope.isSDK&&$scope.noSignUp)},$scope.goToHelpFAQ=function(type){return trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"account FAQ opened from sign in "+("manual"===type?"error message":"FB flow")),!0},$scope.user.dataTmp.init||($scope.user.dataTmp={init:!0,email:localstorage.getItem("rememberLoginValue")||"",password:"",realm:"",rememberMe:$window.here.features.rememberMeByDefault,terms:{token:"",termsURL:"",privacyURL:""},dobRequired:{token:""},marketingConsent:!1,termsToken:"",missing:{countryCode:!1,email:!1},authFed:{code:null,token:null,email:null,countryCode:null,language:$window.here.user.locale.language,me:null}}),$scope.privacyURL=$scope.user.dataTmp.terms.privacyURL,$scope.termsURL=$scope.user.dataTmp.terms.termsURL,$scope.prodTermsURL=$scope.user.dataTmp.terms.prodTermsURL,$scope.errors={},$scope.$parent.changings.loading=!1,$scope.showPassword=!1,$scope.countries=$window.here.countries,$scope.facebookApi=$window.FB,$scope.googleApi=$window.gapi,$scope.firstName="",$scope.lastName="",$scope.userEmail="",$scope.authFedUpdateMe=function(){$scope.user.dataTmp.authFed.me&&($scope.firstName=$scope.user.dataTmp.authFed.me.first_name,$scope.lastName=$scope.user.dataTmp.authFed.me.last_name,$scope.user.dataTmp.authFed.me.email&&($scope.userEmail=$scope.user.dataTmp.authFed.me.email,$scope.user.dataTmp.authFed.email=$scope.user.dataTmp.authFed.me.email))},$scope.authFedUpdateMe(),$scope.signInDone=function(){var qstr=$scope.user.sessionData.userDetails,signInType=$scope.user.sessionData.signInType;localstorage.removeItem("account.oauthFederation"),localstorage.removeItem("account.oauthFederationRealm");var mfaClientIdArray=$location.search().authorizeUri;null!=(mfaClientIdArray=mfaClientIdArray||$scope.authorizeUri)&&0<mfaClientIdArray.length?$window.location=mfaClientIdArray:$scope.isSDK?(mfaClientIdArray=$window.here.config.mfaClientIdArray)?($scope.user.dataResponse=qstr,$scope.user.dataTmp.mfaLoggedInState="sign-in-with-set-mfa",$scope.triggerMFARqdFlow(mfaClientIdArray)):$scope.sdkComplete("sign-in",qstr):(qstr=qstr.realm&&"here"!==qstr.realm.toLowerCase()?"?realm="+qstr.realm:"",$window.location="/"+qstr),trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"successful signin with "+signInType,"","event17")},$scope.$watch("user.dataTmp.email",function(newVal,oldVal){"/sign-in"===$location.path()&&($timeout(function(){var encryptedPassword=$document[0].getElementById("sign-in-password-encrypted");$scope.user.dataTmp.password=$scope.user.dataTmp.password||(encryptedPassword?encryptedPassword.value:"")},100),""!==newVal&&newVal===oldVal||resetOlpSignInForm())}),$scope.$watch("user.dataTmp.authFed.countryCode",function(newVal){$scope.user.dataTmp.termsAccepted=newVal&&$window.here.config.explicitTermsCountries.indexOf(newVal)<0,newVal&&($scope.user.countryCurrent.code=$scope.user.dataTmp.authFed.countryCode,$scope.changeCountry(),$scope.setTerms())}),$scope.abortReAcceptTerms=function(){$location.path("/sign-in")},$scope.welcomeValid=function(){var result=!0;return $scope.user.dataTmp.missing.email&&(result=result&&$scope.user.validateEmail($scope.user.dataTmp.authFed.email)),$scope.user.dataTmp.missing.countryCode&&(result=result&&null!==$scope.user.dataTmp.authFed.countryCode),result=$scope.inExplicitTermsCountry()?result&&$scope.user.dataTmp.termsAccepted:result},$scope.inExplicitTermsCountry=function(){return""!==$scope.user.dataTmp.authFed.countryCode&&-1<$window.here.config.explicitTermsCountries.indexOf($scope.user.dataTmp.authFed.countryCode)},$scope.signInWithLastAuthFed=function(){_authFederations_facebook$0===_lastAuthFedChosen||_authFederations_arcgis$0===_lastAuthFedChosen||_authFederations_google$0===_lastAuthFedChosen||_authFederations_heread$0===_lastAuthFedChosen||_authFederations_verimi$0===_lastAuthFedChosen?($scope.user.dataTmp.realm=_lastAuthFedRealm,signInWithAuthFed(_lastAuthFedChosen)):new Error("No Auth Federation chosen")},$scope.acceptTerms=function(){$scope.user.acceptTermsWithToken({token:$scope.user.dataTmp.terms.token},function(err){err?($scope.errors.server=!0,console.log("acceptTermsWithToken Error: "+err),$scope.setWarning("sign-in-email","general")):$scope.user.dataTmp.authFed.token||$scope.user.dataTmp.authFed.code?$scope.signInWithLastAuthFed():$scope.signIn(),$scope.user.dataTmp.termsAccepted=!1})},$scope.validateDobRequiredForm=function(){FormValidator.validate()&&$scope.saveDobRequired()},$scope.saveDobRequired=function(){$scope.$parent.changings.loading=!0,$scope.user.saveDobRequiredWithToken({token:$scope.user.dataTmp.dobRequired.token},function(err){err?($scope.errors.server=!0,$scope.$parent.changings.loading=!1,console.log("saveDobRequiredWithToken Error: "+err),$scope.setWarning("user-date-of-birth-help","general")):$scope.signIn()})},signInWithAuthFed=function(authFedName){var realm=$scope.user.dataTmp.realm||($window.here.config.sdk?$window.here.config.sdk.realm:"here");$scope.user.sessionData={};try{localstorage.setItem("account.oauthFederation",authFedName),localstorage.setItem("account.oauthFederationRealm",realm),document.getElementById("realm-input")&&"here"!==(realm=document.getElementById("realm-input").value).toLowerCase()&&localstorage.setItem("lastLoginRealm",realm)}catch(e){}$scope.$parent.changings.loading=!0,$scope.user.dataTmp.authFed.countryCode&&$scope.user.dataTmp.missing.countryCode&&($scope.user.dataTmp.missing.countryCode=!1),$scope.user.dataTmp.authFed.email&&$scope.user.dataTmp.missing.email&&($scope.user.dataTmp.missing.email=!1);var authParams={accessToken:$scope.user.dataTmp.authFed.token,realm:realm,countryCode:$scope.user.dataTmp.authFed.countryCode,email:$scope.user.dataTmp.authFed.email,language:$scope.user.dataTmp.authFed.language,rememberMe:$window.here.features.rememberMeByDefault};authFedName===_authFederations_verimi$0&&(authParams={redirectUri:decodeURIComponent($window.here.config.verimi.redirectUri),realm:realm,language:$scope.user.dataTmp.authFed.language,accessToken:$scope.user.dataTmp.authFed.accessToken,idToken:$scope.user.dataTmp.authFed.idToken,userId:$scope.user.dataTmp.authFed.userId,expiresIn:$scope.user.dataTmp.authFed.expiresIn}),$scope.user.signInWithAuthFederation(authFedName,authParams,function(err,status){err=err||!1;if(console.log("status: "+status),err||201===status)if(400===status&&400200===err.errorCode)"countryCode"===err.errorFields[0].name&&($scope.user.dataTmp.missing.countryCode=!0,$scope.user.dataTmp.authFed.countryCode=null,$scope.$parent.changings.loading=!1,$location.path("/welcome-auth"));else if(400===status&&400800===err.errorCode)$scope.user.dataTmp.missing.email=!0,$scope.user.dataTmp.missing.countryCode=!0,$scope.$parent.changings.loading=!1,$location.path("/welcome-auth");else if(400===err.httpStatus&&401111===err.errorCode)$scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"email.mismatch");else if(401===status&&401304===err.errorCode){$scope.$parent.changings.loading=!1,$scope.errors.emailPermission=!0,$scope.setWarning("sign-in-"+authFedName,"facebookEmail");try{localstorage.setItem("account.facebook.rerequest",!0)}catch(e){}}else 401===err.httpStatus&&401500===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"disabled.account")):401===err.httpStatus&&401911===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),console.log("signInWithAuthFederation error with SAML token: status="+status+", err: "+err+", errCode: "+err.errorCode+", message: "+err.message)):412!==status||412001!==err.errorCode&&412002!==err.errorCode?400255===err.errorCode||412306===err.errorCode?($scope.$parent.changings.loading=!1,$scope.errors.server=!0,console.log("error caught: status="+status+", err: "+err+", errCode: "+err.errorCode),412306===err.errorCode?$scope.setWarning("realm-input","inviteToken.required","general"):$scope.setWarning("realm-input","invalid.realm"),$location.path("/sign-in")):201===status?($scope.signInWithLastAuthFed(),trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"successful sign-up with "+authFedName,"","event21")):($scope.$parent.changings.loading=!1,$scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),console.log("signInWithAuthFederation error not handled: status="+status+", err: "+err+", errCode: "+err.errorCode)):($scope.user.dataTmp.terms.token=err.termsReacceptanceToken,$scope.user.dataTmp.terms.termsURL=err.url.tos,$scope.user.dataTmp.terms.privacyURL=err.url.pp,$scope.user.dataTmp.terms.prodTermsURL="https://legal.here.com/terms/here-platform",$scope.user.dataTmp.termsAccepted?$scope.acceptTerms():($scope.$parent.changings.loading=!1,$scope.user.dataTmp.termsAccepted=!1,$location.path("/termsOlp")));else $scope.user.dataTmp.marketingConsent?$scope.user.updateMarketing(!0,function(err,data){err?($scope.errors.server=!0,$scope.setWarning("sign-in-"+authFedName,"general"),$scope.$parent.changings.loading=!1):($scope.user.sessionData={userDetails:data,signInType:authFedName},$scope.platformTermsAndSignInDone(data))}):($scope.user.sessionData={userDetails:status,signInType:authFedName},$scope.platformTermsAndSignInDone(status))})},$scope.signInWithArcGis=function(){signInWithAuthFed(_authFederations_arcgis$0)},$scope.signInWithFacebook=function(){signInWithAuthFed(_authFederations_facebook$0)},$scope.signInWithGoogle=function(){signInWithAuthFed(_authFederations_google$0)},$scope.registerViaFacebook=function(requestOptions){requestOptions={scope:requestOptions||"email,public_profile"};localstorage.getItem("account.facebook.rerequest")&&(requestOptions.auth_type="rerequest"),$scope.facebookApi.init({appId:$window.here.config.facebook.appId,status:$window.here.config.facebook.status,xfbml:$window.here.config.facebook.xfbml,version:"v2.12"}),trackingEnabled&&TrackingService.track("sign-in",SDKTrackingPrefix+"Sign in with Facebook account","",null),$scope.facebookApi.login(function(loginResponse){loginResponse&&loginResponse.authResponse&&(localstorage.removeItem("account.facebook.rerequest"),$scope.user.dataTmp.authFed.token=loginResponse.authResponse.accessToken,$scope.facebookApi.api("/me",function(response){$scope.user.dataTmp.authFed.me=response,$scope.authFedUpdateMe(),signInWithAuthFed(_authFederations_facebook$0)}))},requestOptions)},$scope.trackClick=function(msg){trackingEnabled&&TrackingService.click(SDKTrackingPrefix+msg)},$scope.validateForm=function(){FormValidator.validate()&&$scope.signIn()},$scope.isOlpRealm=function(){return $window.here.olpRealm};$scope.signIn=function(){!function(){if(document.getElementById("sign-in-remember-me")&&document.getElementById("sign-in-remember-me").checked)try{var realm;localstorage.setItem("rememberLoginValue",document.getElementById("sign-in-email").value),!document.getElementById("realm-input")||"here"!==(realm=document.getElementById("realm-input").value).toLowerCase()&&localstorage.setItem("lastLoginRealm",realm)}catch(e){}else localstorage.removeItem("rememberLoginValue"),localstorage.removeItem("lastLoginRealm")}(),$scope.errors={},$scope.user.sessionData={},$scope.$parent.changings.loading=!0,$scope.user.dataTmp.realm||($scope.user.dataTmp.realm=$window.here.realm),$scope.user.signInWithPassword($scope.user.dataTmp,function(err,data){err?(401===err.httpStatus&&401410===err.errorCode?($scope.errors.locked=!0,$scope.setWarning("sign-in-email","locked.account")):401===err.httpStatus&&401500===err.errorCode?($scope.setWarning("sign-in-email","disabled.account"),$scope.errors.credentials=!0):401===err.httpStatus&&401601===err.errorCode?($scope.setWarning("sign-in-email","resend.invite"),$scope.errors.credentials=!0):data&&data.status&&401===data.status&&401010===err.errorCode?($scope.user.dataTmp.mfaLoggedInState="sign-in",$scope.user.dataTmp.mfaAllChannels=err.channels||[],$location.path("/channels")):401===err.httpStatus?($scope.setWarning("sign-in-email","invalid.credentials"),$scope.errors.credentials=!0):412002===err.errorCode||412001===err.errorCode?($scope.user.dataTmp.terms.token=err.termsReacceptanceToken,$scope.user.dataTmp.terms.termsURL=err.url.tos,$scope.user.dataTmp.terms.privacyURL=err.url.pp,$scope.user.dataTmp.terms.prodTermsURL="https://legal.here.com/terms/here-platform",$location.path("/termsOlp")):412003===err.errorCode?($scope.user.dataTmp.dobRequired.token=err.dobRequiredToken,$location.path("/dob-required")):400255===err.errorCode?($scope.errors.server=!0,$scope.setWarning("realm-input","invalid.realm")):($scope.errors.server=!0,$scope.setWarning("sign-in-email","general")),$scope.$parent.changings.loading=!1):($scope.user.sessionData={userDetails:data,signInType:"password"},$scope.platformTermsAndSignInDone(data))})};var resetOlpSignInForm=function(){$scope.olpSignInForm={showRealmInput:!1,showEmailNextBtn:!0,showRealmNextbtn:!1,showNoPlatformAccountMsg:!1,showRequestInviteLink:!1},$scope.isAllowedLoginForRealm={facebook:!1,verimi:!1,google:!1,arcgis:!1,heread:!1,password:!1},$scope.userAccountInfo={accounts:{platform:{realms:[]}},invites:{platform:{realms:[]}}},FormValidator.untrigger(document.getElementById("sign-in-email"))},setupRealmChangeWatcher=function(){$scope.$watch("user.dataTmp.realm",function(newVal,oldVal){for(var key in $scope.isAllowedLoginForRealm)$scope.isAllowedLoginForRealm[key]=!1;FormValidator.untrigger(document.getElementById("realm-input")),""!==newVal&&newVal===oldVal?$scope.validateRealm():$scope.olpSignInForm.showRealmNextbtn=$scope.olpSignInForm.showRealmInput})};$scope.dividerRequiredWithRealm=function(){return $scope.isAllowedLoginForRealm.password&&($scope.isAllowedLoginForRealm.heread||$scope.isAllowedLoginForRealm.arcgis||$scope.isAllowedLoginForRealm.facebook||$scope.isAllowedLoginForRealm.verimi||$scope.isAllowedLoginForRealm.google)},$scope.validateEmailInput=function(){FormValidator.validate()&&$scope.checkAccounts()},$scope.validateRealm=function(isRealmNextBtnVisible){var isRealmInAccountsList=-1!==_.indexOf($scope.userAccountInfo.accounts.platform.realms,$scope.user.dataTmp.realm);-1!==_.indexOf($scope.userAccountInfo.invites.platform.realms,$scope.user.dataTmp.realm)&&!isRealmInAccountsList?$scope.gotoPageWithEmail("/resend-invite"):($scope.changings.loadingEmailNextBtn=!isRealmNextBtnVisible,$scope.changings.loadingRealmNextBtn=!!isRealmNextBtnVisible,DataService.getRealmInfo($scope.user.dataTmp.realm,function(allowedLogins){var realmDetails=allowedLogins.data||{},isOlpPortal=$window.here.config.sdk&&$window.here.config.sdk.isOlpClient;realmDetails&&realmDetails.allowedLogins?!isOlpPortal||"here"!==realmDetails.id.toLowerCase()&&"olp"==realmDetails.realmType?(allowedLogins=realmDetails.allowedLogins,$scope.isAllowedLoginForRealm.password=-1!==_.findIndex(allowedLogins,{method:"password"}),$scope.isAllowedLoginForRealm.heread=-1!==_.findIndex(allowedLogins,{method:"saml"}),$scope.olpSignInForm.showEmailNextBtn=!1,$scope.olpSignInForm.showRealmNextbtn=!1):$scope.setWarning("realm-input","invalid.realm"):realmDetails&&realmDetails.id&&(!isOlpPortal||"here"!==realmDetails.id.toLowerCase()&&"olp"==realmDetails.realmType)?(function(){for(var key in $scope.isAllowedLoginForRealm)$scope.isAllowedLoginForRealm[key]=$scope.isSignInMethodAvailable(key)}(),$scope.olpSignInForm.showEmailNextBtn=!1,$scope.olpSignInForm.showRealmNextbtn=!1):$scope.setWarning("realm-input","invalid.realm"),$scope.changings.loadingEmailNextBtn=!1,$scope.changings.loadingRealmNextBtn=!1,$scope.isAllowedLoginForRealm.password&&$scope.focusElement("sign-in-password-encrypted",250)}))},$scope.checkAccounts=function(){$scope.changings.loadingEmailNextBtn=!0,$scope.user.getSignInUserInfo(function(err,data){if($scope.changings.loadingEmailNextBtn=!1,err)TranslationService.get("hereacc.web.error.general",function(val){FormValidator.trigger(document.getElementById("sign-in-email"),val)});else{if(data.accounts&&data.accounts.platform&&data.accounts.platform.realms&&0<data.accounts.platform.realms.length)try{data.accounts.platform.realms=_.map(data.accounts.platform.realms,function(item){return window.atob(item)})}catch(error){console.error(error),data.accounts.platform.realms=[],data.accounts.platform.multi||(data.accounts.platform.multi=!0)}if(data.invites&&data.invites.platform&&data.invites.platform.realms&&0<data.invites.platform.realms.length)try{data.invites.platform.realms=_.map(data.invites.platform.realms,function(item){return window.atob(item)})}catch(error){console.error(error),data.invites.platform.realms=[]}$scope.userAccountInfo.accounts.platform=data.accounts.platform,$scope.userAccountInfo.invites.platform=data.invites.platform,$scope.userAccountInfo.accounts.platform.exist?$scope.userAccountInfo.accounts.platform.exist&&!$scope.userAccountInfo.accounts.platform.multi?($scope.userAccountInfo.invites.platform.exist&&($scope.olpSignInForm.showRequestInviteLink=!0),$scope.user.dataTmp.realm=$scope.userAccountInfo.accounts.platform.realms[0],$scope.validateRealm()):($scope.userAccountInfo.invites.platform.exist&&($scope.olpSignInForm.showRequestInviteLink=!0),$scope.user.dataTmp.realm="",$scope.olpSignInForm.showEmailNextBtn=!1,$scope.olpSignInForm.showRealmInput=!0,$scope.olpSignInForm.showRealmNextbtn=!0,$scope.focusElement("realm-input",250)):$scope.userAccountInfo.invites.platform.exist?$scope.gotoPageWithEmail("/resend-invite"):(FormValidator.trigger(document.getElementById("sign-in-email")),$scope.olpSignInForm.showNoPlatformAccountMsg=!0)}})},$scope.redirectToPlatformSignUp=function(){$window.location.href=$scope.platformSignUpUrl},$scope.platformTermsInfo=$scope.user.sessionData.platformTermsInfo,$scope.platformTermsInfo&&($scope.platformTermsEffectiveDate=CommonService.getDateLocaleString($scope.platformTermsInfo.effectiveDate,"short"),$scope.platformTermsAcceptDueDate=CommonService.getDateLocaleString($scope.platformTermsInfo.acceptDueDate),$scope.platformTermsURL=$scope.platformTermsInfo.platformTermsUrl,$scope.acceptPlatformTermsAllowed=$scope.platformTermsInfo.acceptServiceTermsAllowed),$scope.platformTerms={checked:!1},$scope.platformTermsAndSignInDone=function(data){$scope.isPlatformTermsReAcceptanceEnabled?$scope.user.getPlatformTermsInfo(function(err,data){err?(console.log("getPlatformTermsInfo failed",err),$scope.signInDone()):data&&data.termsReacceptanceRequired?($scope.user.sessionData.platformTermsInfo=data,$location.path("/platform-terms")):$scope.signInDone()}):$scope.signInDone()},$scope.platformTermsContinue=function(){$scope.signInDone()},$scope.acceptPlatformTerms=function(){$scope.changings.loadingPlatformTerms=!0,$scope.user.acceptPlatformTerms(function(err,data){err&&console.log("acceptPlatformTerms failed",err),$scope.changings.loadingPlatformTerms=!1,$scope.signInDone()})},function(){if($scope.isSDK&&$window.here.config.sdk.decodedInviteToken&&$window.here.config.sdk.decodedInviteToken.errorCode)$scope.sdkMessage({flow:"sign-in",action:"aborted",data:$window.here.config.sdk.decodedInviteToken.errorCode});else{if(trackingEnabled){var presetEmailAddr=$location.search()["client-id"]?$location.search()["client-id"]:null,additionalTrackingParam={};switch($scope.isSDK&&presetEmailAddr&&(additionalTrackingParam.prop55=presetEmailAddr,additionalTrackingParam.eVar55=presetEmailAddr),$location.path()){case"/sign-in":TrackingService.track("sign-in",SDKTrackingPrefix+"signin attempt",additionalTrackingParam,null);break;case"/sign-in-mob":TrackingService.track("sign-in-mob",SDKTrackingPrefix+"signin attempt from mobile",additionalTrackingParam,null);break;case"/welcome-auth":TrackingService.track("welcome-auth",SDKTrackingPrefix+"welcome page after "+_lastAuthFedChosen+" sign-up",additionalTrackingParam,null);break;case"/termsOlp":TrackingService.track("terms",SDKTrackingPrefix+"signin accept terms",additionalTrackingParam,null);break;case"/dob-required":TrackingService.track("dob-required",SDKTrackingPrefix+"signin dob required",additionalTrackingParam,null);break;default:TrackingService.track("sign-in",SDKTrackingPrefix+"signin attempt",additionalTrackingParam,null)}}"/sign-in"===$location.path()&&($scope.isSignInMethodAvailable("arcgis")&&$timeout(function(){$window.require(["esri/arcgis/Portal","esri/arcgis/OAuthInfo","esri/IdentityManager","dojo/domReady!"],function(arcgisPortal,OAuthInfo,esriId){$scope.esriId=esriId,_arcgisPortal=arcgisPortal,_esriInfo=new OAuthInfo({appId:$window.here.config.esri.appId,popupCallbackUrl:"/arcgis/oauth-callback",popup:!0}),$scope.esriId.registerOAuthInfos([_esriInfo]),$scope.$apply()})}),$scope.isSignInMethodAvailable("google")&&initGoogle());presetEmailAddr=$location.search();presetEmailAddr.email?$scope.user.dataTmp.email=decodeURIComponent(presetEmailAddr.email):!$scope.isSDK||0<(presetEmailAddr=$scope.presetEmailAddr()||"").length&&($scope.user.dataTmp.email=presetEmailAddr),FormValidator.init()}$scope.authorizeUri=$location.search().authorizeUri,$scope.olpSignInForm={showRealmInput:!1,showEmailNextBtn:!0,showRealmNextbtn:!1,showNoPlatformAccountMsg:!1,showRequestInviteLink:!1},$scope.isAllowedLoginForRealm={facebook:!1,verimi:!1,google:!1,arcgis:!1,heread:!1,password:!1},$scope.userAccountInfo={accounts:{platform:{realms:[]}},invites:{platform:{realms:[]}}},setupRealmChangeWatcher(),$scope.isInviteTokenValid()&&($scope.user.dataTmp.email=$window.here.config.sdk.decodedInviteToken.email,$scope.user.dataTmp.realm=$window.here.config.sdk.decodedInviteToken.realm||$window.here.realm,$scope.olpSignInForm.showEmailNextBtn=!1,$scope.olpSignInForm.showRealmInput=!0),$scope.focusElement("sign-in-email",250)}()}),angular.module("hereApp.account").controller("AccountSignUpPageCtrl",function($scope,$window,$document,$timeout,$location,TrackingService,FormValidator,TranslationService,CommonService){"use strict";var trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"";$scope.showSignUpWelcomeNotification=!0,$scope.minimumYears=13,$scope.minimumYearsSpain=14,$scope.maximumYears=150,$scope.user.countryCurrent={},$scope.isDateValid=!0,$scope.isInviteTokenValid=CommonService.isInviteTokenValid,$scope.data={days:_.range(1,32),months:$window.here&&$window.here.date&&$window.here.date.months,years:_.range((new Date).getFullYear()-$scope.maximumYears,(new Date).getFullYear()+1).reverse(),countries:$window.here&&$window.here.countries},$scope.unsetDobErrors=function(){$scope.notifications.errors.dob={day:{},month:{},year:{}}},$scope.unsetErrors=function(){$scope.$parent.unsetErrors(),$scope.unsetDobErrors()},$scope.unsetErrors(),$scope.unsetNotifications=function(field,subfield){"dob"===field&&subfield?($scope.notifications.errors.dob&&$scope.notifications.errors.dob[subfield]?$scope.notifications.errors.dob[subfield].blur=!1:$scope.notifications.errors.dob[subfield]={blur:!1},$scope.isDateValid=!0):$scope.$parent.unsetNotifications(field,subfield)},$scope.isEmptyDobField=function(field){return!!isNaN(parseInt($scope.user.dataTmp.dobTmp[field]))},$scope.isEmptyDob=function(){return $scope.isEmptyDobField("day")||$scope.isEmptyDobField("month")||$scope.isEmptyDobField("year")},$scope.isEmptyCountry=function(){return!$scope.user.countryCurrent.code},$scope.isDateBelowMinimumYears=function(){var dob=$scope.user.dataTmp.dobTmp;if(!$scope.isEmptyDob()&&$scope.notifications.errors.dob.day.blur&&$scope.notifications.errors.dob.month.blur&&$scope.notifications.errors.dob.year.blur){var secondsNeeded=2===parseInt(dob.month)&&28<parseInt(dob.day)?28:dob.day,secondsNeeded=(parseInt(dob.year)+$window.here.user.locale.country==="ES"?$scope.minimumYearsSpain:$scope.minimumYears)+"-"+(2===dob.month.length?dob.month:"0"+dob.month)+"-"+(2===secondsNeeded.length?secondsNeeded:"0"+secondsNeeded),secondsNeeded=parseInt(new Date(secondsNeeded).getTime()/1e3);return parseInt(Date.now()/1e3)<secondsNeeded}return-1},$scope.blurDobField=function(field){$scope.notifications.errors.dob&&$scope.notifications.errors.dob[field]?$scope.notifications.errors.dob[field].blur=!0:$scope.notifications.errors.dob[field]={blur:!0},$timeout(function(){var currentElementWithFocusId=$document[0].activeElement.id;"user-date-of-birth-day"!==currentElementWithFocusId&&"user-date-of-birth-month"!==currentElementWithFocusId&&"user-date-of-birth-year"!==currentElementWithFocusId&&($scope.blurredDob=!0)})},$scope.validateForm=function(){FormValidator.validate()?$scope.createUser():console.log("form validate failed")};function assignBlame(errStr,errName,errCode){"password"===errName?FormValidator.invalidatePasswordField(document.getElementById("sign-in-password-encrypted"),errStr):"firstname"===errName?FormValidator.trigger(document.getElementById("user-first-name"),errStr):"lastname"===errName?FormValidator.trigger(document.getElementById("user-last-name"),errStr):"email"===errName?FormValidator.trigger(document.getElementById("user-email"),errStr):"countryCode"===errName?FormValidator.trigger(document.getElementById("user-country"),errStr):"dob"===errName?$scope.isSelfCertifyAge()?console.log("account creation with SelfCertifyAge failed, errName dob"):400211===errCode?$location.path("/forbidden"):400210===errCode?(FormValidator.trigger(document.getElementById("user-date-of-birth-year"),errStr),$scope.isDateValid=!1):FormValidator.trigger(document.getElementById("user-date-of-birth-year"),errStr):409100===errCode?$location.path("/sign-in"):"captcha"===errName?FormValidator.trigger(document.getElementById("user-captcha-input-sign-up"),errStr):"phoneNumber"===errName?FormValidator.trigger(document.getElementById("user-phone"),errStr):"realm"===errName?FormValidator.trigger(document.getElementById("realm-input"),errStr):errStr&&FormValidator.trigger(document.getElementById("validation-error-default"),errStr)}$scope.createUser=function(){$scope.changings.loadingSignup=!0,$scope._handleRequest({type:"create",method:"createUser",arrayData:[$scope.account.passwords.passwordNew],skipResetChange:!0,skipClearPasswords:!0,callbackSuccess:function(mfaClientIdArray){$scope.changings.loadingSignup=!1,$scope.user.dataResponse=mfaClientIdArray,$scope.unsetChangings();mfaClientIdArray=$window.here.config.mfaClientIdArray;mfaClientIdArray?($scope.mfa=$scope.mfa||{},$scope.user.dataTmp.mfaLoggedInState="sign-up-with-set-mfa",$scope.triggerMFARqdFlow(mfaClientIdArray)):(trackingEnabled&&TrackingService.track("sign-up",SDKTrackingPrefix+"successful signin after sign-up","","event17"),"single-column"===$window.here.config.sdk.signInTemplate||"harmony-single"===$window.here.config.sdk.signInTemplate?$scope.diveIn():$location.path("/welcome"))},callbackError:function(errs){$scope.changings.loadingSignup=!1,$scope.clearCaptchaText(),$scope.reloadCaptchaImage();var errorName,errorCode,errorMsg,errorKey,errorStr,eCodeToStringMappingObj={419:"hereacc.web.error.formentry.rejected","000000":"hereacc.web.error.formentry.rejected",400203:{captcha:"hereacc.web.error.captcha.invalid",dob:"hereacc.web.error.dateofbirth.invalid",email:"hereacc.web.error.email.invalid",firstname:"hereacc.web.error.name.invalid",lastname:"hereacc.web.error.name.invalid",phoneNumber:"hereacc.web.error.phoneNumber.invalid",password:"hereacc.web.error.password.invalid.characters",realm:"hereacc.web.signin.error.invalid.realm",_default:"hereacc.web.error.formentry.rejected"},400205:{email:"hereacc.web.error.email.blacklisted",firstname:"hereacc.web.error.firstname.blacklisted",lastname:"hereacc.web.error.lastname.blacklisted",password:"hereacc.web.error.password.blacklisted",_default:"hereacc.web.error.formentry.rejected"},400206:"hereacc.web.error.password.tooshort",400210:"hereacc.web.error.dateofbirth.invalid",400211:"hereacc.web.error.dateofbirth.invalid",400212:"hereacc.web.error.dateofbirth.invalid",400213:"hereacc.web.error.dateofbirth.invalid",400220:"hereacc.web.error.password.invalid.characters",400221:"hereacc.web.error.password.sameasemail",400240:"hereacc.web.error.email.invalid",400250:"hereacc.web.error.phoneNumber.invalid",400260:"hereacc.web.error.formentry.rejected",400261:"hereacc.web.error.formentry.rejected",400601:"hereacc.web.error.inviteToken.invalid",400600:"hereacc.web.error.inviteToken.invalid",400917:"hereacc.web.error.formentry.rejected",401e3:"hereacc.web.error.formentry.rejected",401800:"hereacc.web.error.inviteToken.consumed",404e3:"hereacc.web.signin.error.invalid.realm",409e3:"hereacc.web.error.email.conflict",409100:"hereacc.web.error.email.conflict",412306:"hereacc.web.error.inviteToken.required",403106:"hereacc.web.error.inviteToken.required",429002:"hereacc.web.error.ratelimited",222222:"hereacc.web.error.captcha.empty"};void 0===errs[0]?(errorName="document",errorCode=errs):(errorName=errs[0].name,errorCode=errs[0].errorCode,errorMsg=errs[0].message),eCodeToStringMappingObj.hasOwnProperty(errorCode)?"string"!=typeof eCodeToStringMappingObj[errorCode]?eCodeToStringMappingObj[errorCode].hasOwnProperty(errorName)?errorKey=eCodeToStringMappingObj[errorCode][errorName]:eCodeToStringMappingObj[errorCode].hasOwnProperty("_default")?errorKey=eCodeToStringMappingObj[errorCode]._default:errorMsg?(console.log("errorName: "+errorName+", errorCode: "+errorCode+", errorMsg: "+errorMsg),errorStr=errorMsg):errorKey=eCodeToStringMappingObj["000000"]:errorKey=eCodeToStringMappingObj[errorCode]:errorMsg?(console.log("errorName: "+errorName+", errorCode: "+errorCode+", errorMsg: "+errorMsg),errorStr=errorMsg):(console.log("errorName: "+errorName+", errorCode: "+errorCode+", errorMsg: "+errorMsg+", errs: "+errs),errorKey=eCodeToStringMappingObj["000000"]),errorStr?assignBlame(errorStr,errorName,errorCode):TranslationService.get(errorKey,function(translatedStr){assignBlame(translatedStr,errorName,errorCode)})}})},$scope.diveIn=function(skipUpdate){$scope._handleRequest({type:"diveIn",method:"diveInUser",arrayData:[$scope.account.passwords.passwordNew],skipClearPasswords:!0,skipResetChange:!0,callbackSuccess:function(data){var authorizeUri=$location.search().authorizeUri;null!=authorizeUri&&0<authorizeUri.length?$window.location=authorizeUri+"&no-sign-up=true&realm-input=true":$scope.isSDK?$scope.sdkComplete("sign-up",data):$window.location="/",trackingEnabled&&TrackingService.track("sign-up",SDKTrackingPrefix+"Sign up completed dive in","","event21")},callbackError:function(){}})},$scope.trackClick=function(msg){trackingEnabled&&TrackingService.click(SDKTrackingPrefix+msg)},$scope.isNotSignUpOnly=function(){return!($scope.isSDK&&$scope.onlySignUp)},$scope.flipPwVisibility=function(){$scope.showPassword=!$scope.showPassword,$scope.$parent.focusPwInput($scope.showPassword?"sign-in-password-readable":"sign-in-password-encrypted")},$scope.clearDoBHelp=function(){FormValidator.untrigger(document.getElementById("user-date-of-birth-help"))},$scope.triggerDoBHelp=function(){TranslationService.get("hereacc.web.signup.help.dob",function(val){FormValidator.trigger(document.getElementById("user-date-of-birth-help"),val)})},$scope.isOlpRealm=function(){return $window.here.olpRealm};var meter=document.getElementById("password-strength-meter"),text=document.getElementById("password-strength-text");$scope.$watch(function(){return $scope.account.passwords.passwordNew},function(){var val=$scope.account.passwords.passwordNew||"",passwordStrength=CommonService.scorePassword(val),passwordStrength=CommonService.getPasswordScoreMap(passwordStrength);meter&&(meter.setAttribute("max",4),meter.value=passwordStrength.value),text&&(text.innerHTML=""!==val?passwordStrength.message:"&nbsp;")}),$window.here.config.sdk.restrictedLogin&&-1===$window.here.config.sdk.restrictedLogin.indexOf("password")||$window.here.config.sdk.authForm&&"sign-in"===$window.here.config.sdk.authForm?$location.path("/sign-in"):function(){if($scope.showPassword=!1,$scope.isMarketingEmailEnabled=$window.here.features.enableMarketingEmail,$scope.isSDK&&$window.here.config.sdk.decodedInviteToken&&$window.here.config.sdk.decodedInviteToken.errorCode)$scope.sdkMessage({flow:"sign-up",action:"aborted",data:$window.here.config.sdk.decodedInviteToken.errorCode});else{if(trackingEnabled){var clientId=$location.search()["client-id"]?$location.search()["client-id"]:null,additionalTrackingParam={};switch($scope.isSDK&&clientId&&(additionalTrackingParam.prop55=clientId,additionalTrackingParam.eVar55=clientId),$location.path()){case"/sign-up":TrackingService.track("sign-up",SDKTrackingPrefix+"Sign Up page opened",additionalTrackingParam,null);break;case"/welcome":TrackingService.track("welcome",SDKTrackingPrefix+"Welcome page after sign-up",additionalTrackingParam,null);break;default:TrackingService.track("sign-up",SDKTrackingPrefix+"Sign Up page opened",additionalTrackingParam,null)}}$scope.isSDK&&($scope.user.dataTmp.email=$scope.presetEmailAddr(),$scope.user.dataTmp.realm=$scope.presetRealm()),FormValidator.init()}}()}),angular.module("hereApp.account").controller("AccountChannelsPageCtrl",function($scope,$window,$location,$route,$cookies,$document,TrackingService,UserService,NotificationService){"use strict";function setUpPage(){$scope.user.dataTmp.passcodes={},$scope.user.dataTmp.otpRequestedChannels=[],$scope.updateScopeVariables(),$cookies.get(hereMfaRequired)&&$scope.user.dataTmp.mfaVerifiedChannels&&1===$scope.user.dataTmp.mfaVerifiedChannels.length&&$scope.generateOTP($scope.user.dataTmp.mfaVerifiedChannels[0].channelId)}var hereMfaRequired=$window.here.config.accessCookies.mfaRqdCookieName,hereMfaVerified=$window.here.config.accessCookies.mfaClaimCookieName,hereAccess=$window.here.config.accessCookies.accessCookieName;$scope.channelsFocusElement="",$scope.filteredMFAChannels=[],$scope.changingsMFA={loading:!1},$scope.init=function(){$scope.user.dataTmp.mfaAllChannels||$scope.updateMFAChannels(setUpPage),setUpPage()},$scope.updateScopeVariables=function(){var verifiedChannels=[];$scope.user.dataTmp.mfaAllChannels&&0<$scope.user.dataTmp.mfaAllChannels.length&&$scope.user.dataTmp.mfaAllChannels.forEach(function(channel){$scope.user.dataTmp.passcodes[channel.channelId]||($scope.user.dataTmp.passcodes[channel.channelId]={value:"",error:!1}),channel.type&&"sms"===channel.type&&channel.verified&&!0===channel.verified&&verifiedChannels.push(channel)}),$scope.user.dataTmp.mfaVerifiedChannels=verifiedChannels},$scope.updateMFAChannels=function(callback){$scope.changingsMFA.loading=!0,$scope._handleRequest({type:"getChannels",method:"getMFAChannels",callbackSuccess:function(data){$scope.changingsMFA.loading=!1,$scope.user.dataTmp.mfaAllChannels=data.channels,callback()},callbackError:function(errs){$scope.changingsMFA.loading=!1,NotificationService.showNotification("error",$window.here.notifications.unhandledError)}})},$scope.unsetErrors=function(){$scope.$parent.unsetErrors()},$scope.unsetErrors(),$scope.hasClientErrorsChannelValue=function(){return!(!$scope.isEmpty("channelValue")&&!$scope.isInvalidChannelValue())},$scope.hasErrorsChannelValue=function(){return!(!$scope.hasClientErrorsChannelValue()&&!$scope.hasServerErrorsName("channelValue"))},$scope.createMFAChannel=function(){$scope.changingsMFA.loading=!0,$scope._handleRequest({type:"createChannel",method:"createMFAChannel",arrayData:[{type:"sms",value:$scope.user.dataTmp.channelValue}],callbackSuccess:function(data){switch($scope.changingsMFA.loading=!1,NotificationService.reset(),$scope.user.dataTmp.mfaLoggedInState){case"sign-up-with-set-mfa":case"sign-in-with-set-mfa":$scope.sdkComplete($scope.user.dataTmp.mfaLoggedInState,$scope.user.dataResponse);break;default:$scope.user.dataTmp.mfaAllChannels=$scope.user.dataTmp.mfaAllChannels||[],$scope.user.dataTmp.mfaAllChannels.push({channelId:data.channelId,type:data.type,value:data.value,verified:!1}),$scope.user.dataTmp.channelValue="",$scope.updateScopeVariables()}},callbackError:function(errs){$scope.changingsMFA.loading=!1,errs&&"[object Array]"===Object.prototype.toString.call(errs)&&0<errs.length&&400===Math.round(errs[0].errorCode/1e3)?$scope.notifications.errors.channelValue.invalid=!0:NotificationService.showNotification("error",$window.here.notifications.unhandledError)}})},$scope.deleteMFAChannel=function(channelId){$scope.changingsMFA.loading=!0,$scope._handleRequest({type:"deleteChannel",method:"deleteMFAChannel",arrayData:[channelId],callbackSuccess:function(data){$scope.changingsMFA.loading=!1,NotificationService.reset(),$scope.user.dataTmp.mfaAllChannels=$scope.user.dataTmp.mfaAllChannels||[],$scope.user.dataTmp.mfaAllChannels=$scope.user.dataTmp.mfaAllChannels.filter(function(channel){return channel.channelId!==channelId}),$scope.updateScopeVariables()},callbackError:function(errs){$scope.changingsMFA.loading=!1,NotificationService.showNotification("error",$window.here.notifications.unhandledError)}})},$scope.generateOTP=function(channelId){$scope._handleRequest({type:"mfaSmsGenerateOTP",method:"mfaSmsGenerateOTP",arrayData:[{channelId:channelId}],callbackSuccess:function(data){NotificationService.showNotification("success",$window.here.notifications.mfaPasscode.retryMFACodeSentSuccess),-1===$scope.user.dataTmp.otpRequestedChannels.indexOf(channelId)&&$scope.user.dataTmp.otpRequestedChannels.push(channelId),$scope.channelsFocusElement=channelId},callbackError:function(errs){errs&&errs.errorCode&&429===Math.round(errs.errorCode/1e3)?NotificationService.showNotification("error",$window.here.notifications.mfaPasscode.retryMFACodeTooManyRequests):NotificationService.showNotification("error",$window.here.notifications.mfaPasscode.retryMFACodeSentError)}})},$scope.isOTPRequested=function(channelId){return 0<=$scope.user.dataTmp.otpRequestedChannels.indexOf(channelId)},$scope.removeOTPRequested=function(index){index=$scope.user.dataTmp.otpRequestedChannels.indexOf(index);0<=index&&$scope.user.dataTmp.otpRequestedChannels.splice(index,1)},$scope.showChannel=function(channel){var result=!1;try{return $cookies.get(hereMfaRequired)||$cookies.get(hereAccess)&&!$cookies.get(hereMfaVerified)?($scope.user.dataTmp.mfaVerifiedChannels&&0!==$scope.user.dataTmp.mfaVerifiedChannels.length&&channel.verified||$scope.user.dataTmp.mfaVerifiedChannels&&0===$scope.user.dataTmp.mfaVerifiedChannels.length&&!channel.verified)&&(result=!0):$cookies.get(hereAccess)&&$cookies.get(hereMfaVerified)&&(result=!0),result}catch(error){return console.error(error),result}},$scope.showVerify=function(channel){try{return $scope.showChannel(channel)?!$cookies.get(hereAccess)||!$cookies.get(hereMfaVerified)||!channel.verified:!1}catch(error){return console.error(error),!1}},$scope.showChanDelete=function(channel){try{return $scope.showChannel(channel)?channel.verified?$cookies.get(hereAccess)&&$cookies.get(hereMfaVerified):$cookies.get(hereMfaRequired)||$cookies.get(hereAccess):!1}catch(error){return console.error(error),!1}},$scope.showAddChannel=function(){return($cookies.get(hereMfaRequired)||$cookies.get(hereAccess)&&!$cookies.get(hereMfaVerified))&&(!$scope.user.dataTmp.mfaVerifiedChannels||0===$scope.user.dataTmp.mfaVerifiedChannels.length)||$cookies.get(hereAccess)&&$cookies.get(hereMfaVerified)},$scope.focusAddChannel=function(){return $scope.showAddChannel&&$scope.isSDK},$scope.isValidPasscode=function(channelId){try{return $scope.user.dataTmp.passcodes[channelId].value?!$scope.user.dataTmp.passcodes[channelId].error:!0}catch(error){return console.error(error),!0}},$scope.mfaCodeEntry=function(channelId){$scope.changingsMFA.loading=!0,$scope._handleRequest({type:"mfaCodeEntered",method:"mfaCodeEntered",arrayData:[{channelId:channelId,passcode:$scope.user.dataTmp.passcodes[channelId].value}],callbackSuccess:function(data){$scope.changingsMFA.loading=!1,NotificationService.reset(),$scope.user.dataTmp.passcodes[channelId].error=!1,$scope.removeOTPRequested(channelId),$scope.channelsFocusElement="";var mfaClientIdArray=$window.here.config.mfaClientIdArray;mfaClientIdArray&&"sign-in"===$scope.user.dataTmp.mfaLoggedInState?($scope.user.dataResponse=data,$scope.user.dataTmp.mfaLoggedInState="sign-in-with-set-mfa",$scope.triggerMFARqdFlow(mfaClientIdArray)):$scope.isSDK?$scope.sdkComplete($scope.user.dataTmp.mfaLoggedInState,data):$scope.updateMFAChannels(function(){$scope.updateScopeVariables(),"sign-in"===$scope.user.dataTmp.mfaLoggedInState&&($window.location="/")})},callbackError:function(unhandledErrors){$scope.changingsMFA.loading=!1,!unhandledErrors||"[object Array]"!==Object.prototype.toString.call(unhandledErrors)||(unhandledErrors=unhandledErrors.filter(function(errorCode){errorCode=errorCode.errorCode||errorCode.code;return!(errorCode&&errorCode.toString()in $scope.mappings.passcode)}))&&0<unhandledErrors.length?NotificationService.showNotification("error",$window.here.notifications.unhandledError):$scope.user.dataTmp.passcodes[channelId].error=!0}})},$scope.isUATNoMFAClaimWithVerifiedChannels=function(){return $cookies.get(hereAccess)&&!$cookies.get(hereMfaVerified)&&$scope.user.dataTmp.mfaVerifiedChannels&&0!==$scope.user.dataTmp.mfaVerifiedChannels.length},$scope.init()}),angular.module("hereApp.account").controller("AccountPasswordResetRequestPageCtrl",function($scope,$document,$location,$window,TrackingService,FormValidator,TranslationService){"use strict";var trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"";$scope.isInvalidSubmitPasswordResetRequest=function(){return!!($scope.isEmpty("email")||$scope.isEmpty("captcha")||$scope.hasErrorsEmail()||$scope.hasErrorsCaptcha())},$scope.isNotSignUpOnly=function(){return!($scope.isSDK&&$scope.onlySignUp)},$scope.validateForm=function(){FormValidator.validate()&&$scope.passwordResetRequest()},$scope.passwordResetRequest=function(){$scope._handleRequest({type:"passwordResetRequest",method:"passwordResetRequest",callbackSuccess:function(){$scope.unsetChangings(),trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"password reset request flow executed successful"),$location.path("/reset-password-done")},callbackError:function(errs){$scope.clearCaptchaText(),$scope.reloadCaptchaImage();var errKey="",errField="";"captcha"===errs[0].name?(errKey="hereacc.web.error.captcha.invalid",errField="user-captcha-input-sign-up"):"email"===errs[0].name&&(errField="user-reset-password-email",errKey=401600===errs[0].errorCode?"hereacc.web.error.email.noAccountFound":412100===errs[0].errorCode?"hereacc.web.error.email.federatedAcctNoPw":"hereacc.web.error.email.invalid"),TranslationService.get(errKey,function(val){FormValidator.trigger(document.getElementById(errField),val)})}})},$scope.init=function(){var clientId;$scope.clearCaptchaText(),$scope.reloadCaptchaImage(),$document.on("keyup",function(event){13===event.keyCode&&($scope.isInvalidSubmitPasswordResetRequest()||$scope.$apply(function(){$scope.passwordResetRequest()}))}),trackingEnabled&&(clientId=$location.search()["client-id"]?$location.search()["client-id"]:null,queryParamsObject={},$scope.isSDK&&clientId&&(queryParamsObject.prop55=clientId,queryParamsObject.eVar55=clientId),TrackingService.track("reset-password",SDKTrackingPrefix+"password reset request opened",queryParamsObject,null));var queryParamsObject=$location.search();queryParamsObject.email&&queryParamsObject.realm?($scope.user.dataTmp.email=decodeURIComponent(queryParamsObject.email),$scope.user.dataTmp.realm=decodeURIComponent(queryParamsObject.realm)):$scope.isSDK?($scope.user.dataTmp.email=$scope.presetEmailAddr(),$scope.user.dataTmp.realm=$scope.presetRealm()):$scope.user.dataTmp.realm||($scope.user.dataTmp.realm=$window.here.realm),FormValidator.init()},$scope.init()}),angular.module("hereApp.account").controller("AccountForgotOrgIdCtrl",function($scope,$window,$document,$location,TrackingService,FormValidator,TranslationService){"use strict";var trackingEnabled=$window.here.features.enableTracking;$scope.isInvalidSubmitForgotOrgIDRequest=function(){return!!($scope.isEmpty("email")||$scope.isEmpty("captcha")||$scope.hasErrorsEmail()||$scope.hasErrorsCaptcha())},$scope.isNotSignUpOnly=function(){return!($scope.isSDK&&$scope.onlySignUp)},$scope.validateForm=function(){FormValidator.validate()&&$scope.forgotOrgIdRequest()},$scope.forgotOrgIdRequest=function(){$scope.changings.forgotOrgIdRequest=!0,$scope._handleRequest({type:"forgotOrgIdRequest",method:"forgotOrgIdRequest",callbackSuccess:function(){$scope.changings.forgotOrgIdRequest=!1,$scope.unsetChangings(),trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"forgot org id request flow executed successful"),$location.path("/forgot-org-id-done")},callbackError:function(errs){$scope.clearCaptchaText(),$scope.reloadCaptchaImage(),$scope.changings.forgotOrgIdRequest=!1;var errKey="",errField="";console.log(errs),Array.isArray(errs)?errs[0]&&"captcha"===errs[0].name?(errKey="hereacc.web.error.captcha.invalid",errField="user-captcha-input-forgot-orgId"):errs[0]&&"email"===errs[0].name&&(errKey="hereacc.web.error.email.invalid",errField="user-email-input-forgot-orgId"):(errKey="hereacc.web.error.general",errField="user-email-input-forgot-orgId"),TranslationService.get(errKey,function(val){FormValidator.trigger(document.getElementById(errField),val)})}})},$scope.init=function(){var clientId;$scope.clearCaptchaText(),$scope.reloadCaptchaImage(),$scope.changings={forgotOrgIdRequest:!1},$document.on("keyup",function(event){13===event.keyCode&&($scope.isInvalidSubmitForgotOrgIDRequest()||$scope.$apply(function(){$scope.forgotOrgIdRequest()}))}),trackingEnabled&&(clientId=$location.search()["client-id"]?$location.search()["client-id"]:null,queryParamsObject={},$scope.isSDK&&clientId&&(queryParamsObject.prop55=clientId,queryParamsObject.eVar55=clientId),TrackingService.track("forgot-org-id",SDKTrackingPrefix+"forgot orgId request opened",queryParamsObject,null));var queryParamsObject=$location.search();queryParamsObject.email?$scope.user.dataTmp.email=decodeURIComponent(queryParamsObject.email):$scope.isSDK&&($scope.user.dataTmp.email=$scope.presetEmailAddr()),FormValidator.init()},$scope.init()}),angular.module("hereApp.account").controller("AccountResendInviteCtrl",function($scope,$window,$document,$location,TrackingService,FormValidator,TranslationService){"use strict";var trackingEnabled=$window.here.features.enableTracking;$scope.isInvalidSubmitResendInviteRequest=function(){return!!($scope.isEmpty("email")||$scope.isEmpty("captcha")||$scope.hasErrorsEmail()||$scope.hasErrorsCaptcha())},$scope.isNotSignUpOnly=function(){return!($scope.isSDK&&$scope.onlySignUp)},$scope.validateForm=function(){FormValidator.validate()&&$scope.resendInviteRequest()},$scope.resendInviteRequest=function(){$scope.changings.resendInviteRequest=!0,$scope._handleRequest({type:"resendInviteRequest",method:"resendInviteRequest",callbackSuccess:function(){$scope.changings.resendInviteRequest=!1,$scope.unsetChangings(),trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"resend invite request flow executed successful"),$location.path("/resend-invite-done")},callbackError:function(errs){$scope.clearCaptchaText(),$scope.reloadCaptchaImage(),$scope.changings.resendInviteRequest=!1;var errKey="",errField="";Array.isArray(errs)?errs[0]&&"captcha"===errs[0].name?(errKey="hereacc.web.error.captcha.invalid",errField="user-captcha-input-resend-invite"):errs[0]&&"email"===errs[0].name&&(errKey="hereacc.web.error.email.invalid",errField="user-email-input-resend-invite"):(errKey="hereacc.web.error.general",errField="user-email-input-resend-invite"),TranslationService.get(errKey,function(val){FormValidator.trigger(document.getElementById(errField),val)})}})},$scope.init=function(){var clientId;$scope.clearCaptchaText(),$scope.reloadCaptchaImage(),$scope.changings={resendInviteRequest:!1},$document.on("keyup",function(event){13===event.keyCode&&($scope.isInvalidSubmitResendInviteRequest()||$scope.$apply(function(){$scope.resendInviteRequest()}))}),trackingEnabled&&(clientId=$location.search()["client-id"]?$location.search()["client-id"]:null,queryParamsObject={},$scope.isSDK&&clientId&&(queryParamsObject.prop55=clientId,queryParamsObject.eVar55=clientId),TrackingService.track("resend-invite",SDKTrackingPrefix+"Resend Invite request opened",queryParamsObject,null));var queryParamsObject=$location.search();queryParamsObject.email?$scope.user.dataTmp.email=decodeURIComponent(queryParamsObject.email):$scope.isSDK&&($scope.user.dataTmp.email=$scope.presetEmailAddr()),FormValidator.init()},$scope.init()}),angular.module("hereApp.account").controller("EmailVerifyRequestPageCtrl",function($scope,$document,$location,$window,TrackingService,FormValidator){"use strict";var trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"";$scope.validateForm=function(){FormValidator.validate()&&$scope.emailVerifyRequest()},$scope.emailVerifyRequest=function(){$scope.user.data.email=$scope.user.dataTmp.email,$scope._handleRequest({type:"emailVerification",method:"emailVerifyRequest",callbackSuccess:function(){trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"email verify request flow executed successful"),$scope.isSDK?$scope.sdkComplete("email-verify"):$scope.goto("/settings",!1)},callbackError:function(errs){$scope.isSDK?$scope.sdkComplete("email-verify",errs):$scope.goto("/settings",!1)}})},$scope.init=function(){var clientId,additionalTrackingParam;$scope.isSDK&&($scope.user.dataTmp.email=$scope.presetEmailAddr()),$document.on("keyup",function(event){13===event.keyCode&&$scope.$apply(function(){$scope.validateForm()})}),trackingEnabled&&(clientId=$location.search()["client-id"]?$location.search()["client-id"]:null,additionalTrackingParam={},$scope.isSDK&&clientId&&(additionalTrackingParam.prop55=clientId,additionalTrackingParam.eVar55=clientId),TrackingService.track("email-verify",SDKTrackingPrefix+"email verify request opened",additionalTrackingParam,null)),FormValidator.init()},$scope.init()}),angular.module("hereApp.account").controller("PasswordChangePageCtrl",function($scope,$document,$window,TrackingService,FormValidator,TranslationService,CommonService){"use strict";var currentFieldName="",trackingEnabled=$window.here.features.enableTracking,SDKTrackingPrefix=$scope.isSDK?"SDK: ":"";$scope.pwdEmpty=!1,$scope.pwdServerError=!1,$scope.showPassword=!1,$scope.handleFocus=function(evt){currentFieldName=$scope.accountForm[evt.target.name]},$scope.handleBlur=function(evt){evt.target.name===currentFieldName.$name&&currentFieldName.$isEmpty(currentFieldName.$viewValue)&&($scope.pwdEmpty=!0),$scope.pwdServerError&&($scope.pwdServerError=!1)},$scope.unsetAreas=function(){$scope.areas={}},$scope.unsetAreas(),$scope.switchToArea=function(areaName){$scope.unsetAreas(),$scope.unsetChangings(),$scope.unsetNotifications(),$scope.user.restoreData(),areaName&&($scope.areas[areaName]=!0)},$scope.closeAreas=function(){$scope.switchToArea()},$scope.unsetNotifications=function(field,all){$scope.pwdEmpty=!1,$scope.pwdServerError=!1,field?all?$scope.$parent.unsetNotifications(field,all):$scope.$parent.unsetNotifications(field):$scope.$parent.unsetNotifications(!1)},$scope.isInvalidSubmitPassword=function(){return!(!$scope.isEmptyPassword("passwordNew")&&!$scope.hasErrorsPasswordNew())},$scope.cancelChangePassword=function(){$scope.accountForm.$setPristine(),$scope.clearPasswords(),$scope.closeAreas(),$scope.goToSignIn()},$scope.goToSignIn=function(){var redirectUrl;"jaguar"===document.getElementById("realm").value.toLowerCase()?$window.location="https://jaguar.here.com":"landrover"===document.getElementById("realm").value.toLowerCase()?$window.location="https://landrover.here.com":(redirectUrl=document.getElementById("redirectUrl").value)&&"http"===redirectUrl.substr(0,4)?$window.location=redirectUrl:$window.location="/sign-in"},$scope.validateForm=function(){FormValidator.validate()&&$scope.changePassword()},$scope.changePassword=function(){$scope.user.data.passwordResetToken=$window.here.passwordResetToken,$scope._handleRequest({type:"changeUserPassword",method:"changeUserPassword",arrayData:[document.getElementById("passwordResetToken").value,$scope.account.passwords.passwordNew],callbackSuccess:function(){$scope.accountForm.$setPristine(),$scope.clearPasswords(),$scope.closeAreas(),$scope.notifications.successes.changedPassword=!0,trackingEnabled&&TrackingService.click(SDKTrackingPrefix+"password reset request flow executed successful"),$scope.areas.passwordChangeSucceeded=!0},callbackError:function(errs){errs&&errs[0]&&errs[0].errorCode&&"newPassword"===errs[0].name?FormValidator.invalidatePasswordField(document.getElementById("user-password-new-encrypted"),errs[0].message):($scope.switchToArea(),$scope.areas.passwordChangeTokenInvalid=!0)}})},$scope.flipPwVisibility=function(){$scope.showPassword=!$scope.showPassword,$scope.$parent.focusPwInput($scope.showPassword?"user-password-new-readable":"user-password-new-encrypted")},$scope.isOlpRealm=function(){return $window.here.olpRealm};function setBanner(label,url){document.getElementById("go-home").innerHTML="<a href='"+url+"' target='_blank'>"+label+"</a>"}$scope.init=function(){var restartFlowLink,realm=document.getElementById("realm").value.toLowerCase(),redirectUrl=document.getElementById("redirectUrl").value,passwordResetToken=document.getElementById("passwordResetToken").value;redirectUrl&&"http"===redirectUrl.substr(0,4)?(document.getElementById("signInTarget1").href=redirectUrl,document.getElementById("signInTarget2").href=redirectUrl,document.getElementById("signInTarget3").href=redirectUrl):"here"!==realm&&(redirectUrl=document.getElementById("signInTarget1").href+"?realm="+realm,document.getElementById("signInTarget1").href=redirectUrl,document.getElementById("signInTarget2").href=redirectUrl,document.getElementById("signInTarget3").href=redirectUrl,restartFlowLink=document.getElementById("restartFlowLink").href,document.getElementById("restartFlowLink").href=restartFlowLink+"?realm="+realm),$scope.clearPasswords(),$scope.unsetChangings(),""===passwordResetToken&&($scope.switchToArea(),$scope.areas.passwordChangeTokenInvalid=!0),"jaguar"===realm?(redirectUrl="https://jaguar.here.com/",TranslationService.get("hereacc.auto.silv.web.jaguar.goto",function(val){setBanner(val,redirectUrl)}),document.getElementById("restartFlowLink").href="https://jaguar.here.com/?pw",document.getElementById("signInTarget1").href=redirectUrl,document.getElementById("signInTarget2").href=redirectUrl,document.getElementById("signInTarget3").href=redirectUrl):"landrover"===realm&&(redirectUrl="https://landrover.here.com/",TranslationService.get("hereacc.auto.silv.web.landrover.goto",function(val){setBanner(val,redirectUrl)}),document.getElementById("restartFlowLink").href="https://landrover.here.com/?pw",document.getElementById("signInTarget1").href=redirectUrl,document.getElementById("signInTarget2").href=redirectUrl,document.getElementById("signInTarget3").href=redirectUrl),$scope.isOlpRealm()&&(document.getElementById("realm-name-field").innerText=realm.toString()),$document.on("keyup",function(event){27===event.keyCode&&$scope.$apply(function(){$scope.closeAreas()}),13===event.keyCode&&$scope.$apply(function(){$scope.isInvalidSubmitPassword()||$scope.changePassword()})}),trackingEnabled&&TrackingService.track("account",SDKTrackingPrefix+"password change page opened","",null),FormValidator.init()};var meter=document.getElementById("password-strength-meter"),text=document.getElementById("password-strength-text");$scope.$watch(function(){return $scope.account.passwords.passwordNew},function(){var val=$scope.account.passwords.passwordNew||"",passwordStrength=CommonService.scorePassword(val),passwordStrength=CommonService.getPasswordScoreMap(passwordStrength);meter&&(meter.setAttribute("max",4),meter.value=passwordStrength.value),text&&(text.innerHTML=""!==val?passwordStrength.message:"&nbsp;")}),$scope.init()}),angular.module("hereApp.directive").directive("href",function($window){"use strict";return{link:function(scope,element,attrs){("_blank"===attrs.target||0<=attrs.href.indexOf("account.here.com"))&&element.bind("click",function(event){event.preventDefault(),$window.open(attrs.href,attrs.title||"Here.com")})}}}),angular.module("hereApp.directive").directive("footer",function($window,$rootScope,CountryService){"use strict";return function(scope){var h=$window.here,user=(h.config,h.user);scope.countryCode=CountryService.get(user.locale&&user.locale.country)||"gb",scope.language=user.locale&&user.locale.language||"en",scope.copyright=h.copyright,scope.copyright.yearCurrent=(new Date).getFullYear(),$rootScope.$on("eventCountryChanged",function(event,data){scope.countryCode=CountryService.get(data.newCountryCode),scope.language=data.newLanguage})}}),angular.module("hereApp.directive").directive("fixedNotificationBox",function($rootScope,$window,$document,NotificationService){"use strict";return{replace:!0,template:'<div><div class="fixed-notification-box" data-ng-class="fixedNotificationType" data-ng-show="showFixedNotification"><div id="fixedNotificationContentId" data-ng-bind-html="fixedNotificationContent"></div><button type="button" class="close" data-ng-click="NotificationService.showFixedNotification = false"><img src="/img/iconClose.svg"/></button></div></div>',link:function(scope,element,attrs){scope.NotificationService=NotificationService,scope.$watch("NotificationService.showFixedNotification + NotificationService.fixedNotificationType + NotificationService.fixedNotificationContent",function(newValue,oldValue){scope.fixedNotificationType=NotificationService.fixedNotificationType,scope.showFixedNotification=NotificationService.showFixedNotification,scope.fixedNotificationContent=NotificationService.fixedNotificationContent},!0)}}}),angular.module("hereApp.directive").directive("sizeListener",function($location,$rootScope,$window,$timeout,$interval){"use strict";return{link:function(scope,element,attrs){function setHeight(newHeight){height=newHeight,$window.here.config.sdk&&$window.here.config.sdk.signInTemplate&&("clm"===$window.here.config.sdk.signInTemplate||"single-column"===$window.here.config.sdk.signInTemplate||"harmony-single"===$window.here.config.sdk.signInTemplate)&&(messageBody="clm"===$window.here.config.sdk.signInTemplate?{flow:"clm",action:"frame resized",data:{height:height}}:{flow:$location.path().replace("/",""),action:"frame resized",data:height},scope.sdkMessage(messageBody))}function checkHeight(){var newHeight=element[0].offsetHeight;newHeight!==height&&setHeight(newHeight)}var height,messageBody={};scope.$watch(function(){return element[0].offsetHeight},function(newValue,oldValue){newValue!==oldValue&&setHeight(newValue)},!0),$timeout(function(){checkHeight()},100),$interval(checkHeight,1e3)}}}),angular.module("hereApp.directive").directive("notificationBox",function(){"use strict";return{replace:!0,scope:{showNotification:"=",notificationType:"@"},transclude:!0,template:'<div class="notification-box" data-ng-class="notificationType" data-ng-show="showNotification"><div data-ng-transclude></div><button type="button" class="close" data-ng-click="showNotification = false"><img src="/img/icons/close.svg"></button></div>'}}),angular.module("hereApp.directive").directive("infoIcon",function($rootScope,$window,$document){"use strict";function setKnifePosition(element){var position,iconOffsetLeft,position=(iconOffsetLeft=(position=element)[0].querySelector(".info-icon").offsetLeft,position=position[0].querySelector(".info-message-container"),position=$window.getComputedStyle(position),iconOffsetLeft-parseInt(position.paddingLeft,10));angular.element(element[0].querySelector(".knife")).css({"-webkit-transform":"translateX("+position+"px)",transform:"translateX("+position+"px)"})}return{replace:!0,transclude:!0,scope:{},template:'<div class="info-icon-container"><span class="info-icon"></span><div class="info-message-container" data-ng-show="infoIcon.showMessage"><div class="knife"><div></div></div><div class="info-message" data-ng-transclude></div></div></div>',link:function(scope,element){var elementInfoIcon=angular.element(element[0].querySelector(".info-icon"));scope.infoIcon={showMessage:!1,wasClicked:!0},$document.on("click",function(){scope.$apply(function(){scope.infoIcon.wasClicked||(scope.infoIcon.showMessage=!1),scope.infoIcon.wasClicked=!1})}),elementInfoIcon.bind("click",function(){setKnifePosition(element),scope.$apply(function(){scope.infoIcon.showMessage=!scope.infoIcon.showMessage,scope.infoIcon.wasClicked=!0})})}}}),angular.module("hereApp.directive").directive("hereFocusAndSelect",function($document,$timeout){"use strict";return{link:function(scope,element,attrs){scope.$watch(function(){return!!scope.$eval(attrs.hereFocusAndSelect)},function(newValue){!newValue||scope.triggered||element.hasClass("ng-hide")||(scope.triggered=!0,$timeout(function(){element[0].focus(),element[0].setSelectionRange(0,element[0].value.length)}))}),$document.bind("click keydown keyup blur",function(){scope.triggered=!1})}}}),angular.module("hereApp.service").factory("CountryService",function(){"use strict";var list={AFG:"AF",ALA:"AX",ALB:"AL",DZA:"DZ",ASM:"AS",AND:"AD",AGO:"AO",AIA:"AI",ATA:"AQ",ATG:"AG",ARG:"AR",ARM:"AM",ABW:"AW",AUS:"AU",AUT:"AT",AZE:"AZ",BHS:"BS",BHR:"BH",BGD:"BD",BRB:"BB",BLR:"BY",BEL:"BE",BLZ:"BZ",BEN:"BJ",BMU:"BM",BTN:"BT",BOL:"BO",BES:"BQ",BIH:"BA",BWA:"BW",BVT:"BV",BRA:"BR",IOT:"IO",BRN:"BN",BGR:"BG",BFA:"BF",BDI:"BI",KHM:"KH",CMR:"CM",CAN:"CA",CPV:"CV",CYM:"KY",CAF:"CF",TCD:"TD",CHL:"CL",CHN:"CN",CXR:"CX",CCK:"CC",COL:"CO",COM:"KM",COG:"CG",COD:"CD",COK:"CK",CRI:"CR",CIV:"CI",HRV:"HR",CUB:"CU",CUW:"CW",CYP:"CY",CZE:"CZ",DNK:"DK",DJI:"DJ",DMA:"DM",DOM:"DO",ECU:"EC",EGY:"EG",SLV:"SV",GNQ:"GQ",ERI:"ER",EST:"EE",ETH:"ET",FLK:"FK",FRO:"FO",FJI:"FJ",FIN:"FI",FRA:"FR",GUF:"GF",PYF:"PF",ATF:"TF",GAB:"GA",GMB:"GM",GEO:"GE",DEU:"DE",GHA:"GH",GIB:"GI",GRC:"GR",GRL:"GL",GRD:"GD",GLP:"GP",GUM:"GU",GTM:"GT",GGY:"GG",GIN:"GN",GNB:"GW",GUY:"GY",HTI:"HT",HMD:"HM",VAT:"VA",HND:"HN",HKG:"HK",HUN:"HU",ISL:"IS",IND:"IN",IDN:"ID",IRN:"IR",IRQ:"IQ",IRL:"IE",IMN:"IM",ISR:"IL",ITA:"IT",JAM:"JM",JPN:"JP",JEY:"JE",JOR:"JO",KAZ:"KZ",KEN:"KE",KIR:"KI",PRK:"KP",KOR:"KR",KWT:"KW",KGZ:"KG",LAO:"LA",LVA:"LV",LBN:"LB",LSO:"LS",LBR:"LR",LBY:"LY",LIE:"LI",LTU:"LT",LUX:"LU",MAC:"MO",MKD:"MK",MDG:"MG",MWI:"MW",MYS:"MY",MDV:"MV",MLI:"ML",MLT:"MT",MHL:"MH",MTQ:"MQ",MRT:"MR",MUS:"MU",MYT:"YT",MEX:"MX",FSM:"FM",MDA:"MD",MCO:"MC",MNG:"MN",MNE:"ME",MSR:"MS",MAR:"MA",MOZ:"MZ",MMR:"MM",NAM:"NA",NRU:"NR",NPL:"NP",NLD:"NL",NCL:"NC",NZL:"NZ",NIC:"NI",NER:"NE",NGA:"NG",NIU:"NU",NFK:"NF",MNP:"MP",NOR:"NO",OMN:"OM",PAK:"PK",PLW:"PW",PSE:"PS",PAN:"PA",PNG:"PG",PRY:"PY",PER:"PE",PHL:"PH",PCN:"PN",POL:"PL",PRT:"PT",PRI:"PR",QAT:"QA",REU:"RE",ROU:"RO",RUS:"RU",RWA:"RW",BLM:"BL",SHN:"SH",KNA:"KN",LCA:"LC",MAF:"MF",SPM:"PM",VCT:"VC",WSM:"WS",SMR:"SM",STP:"ST",SAU:"SA",SEN:"SN",SRB:"RS",SYC:"SC",SLE:"SL",SGP:"SG",SXM:"SX",SVK:"SK",SVN:"SI",SLB:"SB",SOM:"SO",ZAF:"ZA",SGS:"GS",SSD:"SS",ESP:"ES",LKA:"LK",SDN:"SD",SUR:"SR",SJM:"SJ",SWZ:"SZ",SWE:"SE",CHE:"CH",SYR:"SY",TWN:"TW",TJK:"TJ",TZA:"TZ",THA:"TH",TLS:"TL",TGO:"TG",TKL:"TK",TON:"TO",TTO:"TT",TUN:"TN",TUR:"TR",TKM:"TM",TCA:"TC",TUV:"TV",UGA:"UG",UKR:"UA",ARE:"AE",GBR:"GB",USA:"US",UMI:"UM",URY:"UY",UZB:"UZ",VUT:"VU",VEN:"VE",VNM:"VN",VGB:"VG",VIR:"VI",WLF:"WF",ESH:"EH",YEM:"YE",ZMB:"ZM",ZWE:"ZW"};return{get:function(threeLettersCode){return threeLettersCode=threeLettersCode||"",(_.has(list,threeLettersCode)?list[threeLettersCode]:threeLettersCode).toLowerCase()},getByTwoLettersCode:function(twoLettersCode){return _.findKey(list,function(o){return o===twoLettersCode})||""}}}),angular.module("hereApp.service").factory("TrackingService",function($window){"use strict";var tracking={mocked:!!window.here.features.mocked,track:function(page,action,customVars,goal){},click:function(name){}};return tracking}),angular.module("hereApp.service").factory("TranslationService",function($window,$http){"use strict";function get(text,data,cb){if(callback=_.isFunction(data)?data:(keys=data,cb),0===Object.keys(translations).length)!function(cb){$http.get("/translations/translations-"+getLocale()+".json").then(function(success){translations=success.data.data,cb()})}(function(){get(text,keys,callback)});else{var returnData=translations[text]||"";if(_.each(keys,function(value,key){returnData=_.replace(returnData,new RegExp("{{"+key+"}}","g"),value)}),!_.isFunction(callback))return returnData;callback(returnData)}}var callback,translations={},keys={},getLocale=function(){try{return $window.here.user.locale.tag||"en-US"}catch(err){return"en-US"}};return{get:get}}),angular.module("hereApp.service").factory("FormValidator",function(){"use strict";function trigger(field,title){field.focus(),field.classList.add("invalid"),title&&(field.parentElement.setAttribute("data-balloon",title),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit"))}var fields,emailExpression=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,phoneNumberExpression=/^[+() \-.x\d]{7,}$/,colorPasswordField=function(invalid){_.each(document.querySelectorAll("#pw-container .is-required"),function(elem){invalid?elem.classList.add("invalid"):elem.classList.remove("invalid")})};return{validate:function(){var needs;return _.each(fields,function(field){return field.parentElement.removeAttribute("data-balloon"),field.parentElement.removeAttribute("data-balloon-visible"),field.parentElement.classList.remove("tooltip","invalid"),field.classList.remove("invalid"),needs=JSON.parse(field.getAttribute("data-reqs")),_.forIn(needs,function(value,key){switch(key){case"min-length":!function(field,min){0<field.offsetHeight&&field.value.length<min&&(field.focus(),field.classList.add("invalid"),field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-empty")),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit"))}(field,value);break;case"valid-phone":!function(field){field.value.match(phoneNumberExpression)||(field.focus(),field.classList.add("invalid"),field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-invalid")),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit"))}(field);break;case"valid-email":!function(field){field.value.trim().match(emailExpression)||(field.focus(),field.classList.add("invalid"),field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-invalid")),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit"))}(field);break;case"valid-password":!function(field){0<field.parentElement.offsetHeight&&field.value.length<6?(field.focus(),colorPasswordField(!0),field.value.length<6?field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-empty")):field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-invalid")),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit")):colorPasswordField(!1)}(field);break;case"select":!function(field){""===field.value&&(field.focus(),field.classList.add("invalid"),field.parentElement.setAttribute("data-balloon",field.getAttribute("data-error-empty")),field.parentElement.setAttribute("data-balloon-visible",!0),field.parentElement.setAttribute("data-balloon-length","fit"))}(field);break;case"checked":!function(field){0<field.offsetHeight&&!field.checked&&(field.focus(),field.parentElement.classList.add("invalid"),field.classList.add("invalid"))}(field)}return!field.classList.contains("invalid")}),!field.classList.contains("invalid")}),!document.querySelectorAll(".invalid").length},trigger:trigger,untrigger:function(field){field&&(field.classList.remove("invalid"),field.parentElement.removeAttribute("data-balloon"),field.parentElement.removeAttribute("data-balloon-visible"))},invalidatePasswordField:function(field,title){colorPasswordField(!0),trigger(field,title)},init:function(){fields=document.getElementsByClassName("is-required"),document.querySelector("body").addEventListener("click",function(field){field=field.target;field.classList.contains("is-required")&&(field.onclick=function(elem){this.parentElement.removeAttribute("data-balloon"),this.parentElement.removeAttribute("data-balloon-visible"),this.parentElement.classList.remove("tooltip","invalid"),this.classList.remove("invalid"),"sign-in-password-encrypted"==this.getAttribute("id")&&document.querySelector("#sign-in-password-readable").classList.remove("invalid")})},!0)}}}),angular.module("hereApp.service").factory("FormValidatorSelfServe",function(){"use strict";var fields,emailExpression=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,phoneNumberExpression=/^[+() \-.x\d]{7,}$/;var getNextSibling=function(elem,selector){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var sibling=elem.nextElementSibling;if(!selector)return sibling;for(;sibling;){if(sibling.matches(selector))return sibling;sibling=sibling.nextElementSibling}};function addErrorMessage(field,message){var element=document.createElement("span");element.classList.add("error-message"),element.innerHTML=message,field.parentNode.append(element)}function removeErrorMessage(errorElem){errorElem=getNextSibling(errorElem,".error-message");errorElem&&errorElem.remove()}function trigger(field,title){field.focus(),field.classList.add("invalid"),title&&addErrorMessage(field,title)}var colorPasswordField=function(invalid,isConfirm){isConfirm?_.each(document.querySelectorAll("#confirm-pw-container .is-required"),function(elem){invalid?elem.classList.add("invalid"):elem.classList.remove("invalid")}):_.each(document.querySelectorAll("#pw-container .is-required"),function(elem){invalid?elem.classList.add("invalid"):elem.classList.remove("invalid")})};return{validate:function(){var needs;return _.each(fields,function(field){return removeErrorMessage(field),field.parentElement.classList.remove("tooltip","invalid"),field.classList.remove("invalid"),needs=JSON.parse(field.getAttribute("data-reqs")),_.forIn(needs,function(value,key){switch(key){case"min-length":!function(field,min){0<field.offsetHeight&&field.value.trim().length<min&&(field.focus(),field.classList.add("invalid"),addErrorMessage(field,field.getAttribute("data-error-empty")))}(field,value);break;case"valid-phone":!function(field){field.value.match(phoneNumberExpression)||(field.focus(),field.classList.add("invalid"),addErrorMessage(field,field.getAttribute("data-error-invalid")))}(field);break;case"valid-email":!function(field){field.value.trim().match(emailExpression)||(field.focus(),field.classList.add("invalid"),addErrorMessage(field,field.getAttribute("data-error-invalid")))}(field);break;case"valid-password":!function(field){0<field.parentElement.offsetHeight&&field.value.trim().length<6?(field.focus(),colorPasswordField(!0),field.value.length<6?addErrorMessage(field,field.getAttribute("data-error-empty")):addErrorMessage(field,field.getAttribute("data-error-invalid"))):colorPasswordField(!1)}(field);break;case"confirm-password":!function(field){var passwordField=document.querySelector("#pw-container .need-to-be-confirmed");field.value===passwordField.value?(colorPasswordField(!1,!0),removeErrorMessage(field)):(field.focus(),colorPasswordField(!0,!0),addErrorMessage(field,field.getAttribute("data-error-mismatch")))}(field);break;case"select":!function(field){""===field.value&&(field.focus(),field.classList.add("invalid"),addErrorMessage(field,field.getAttribute("data-error-empty")))}(field);break;case"checked":!function(field){0<field.offsetHeight&&!field.checked&&(field.focus(),field.classList.add("invalid"),addErrorMessage(field,field.getAttribute("data-error-empty")))}(field)}return!field.classList.contains("invalid")}),!field.classList.contains("invalid")}),!document.querySelectorAll(".invalid").length},trigger:trigger,untrigger:function(field){field&&(field.classList.remove("invalid"),removeErrorMessage(field))},invalidatePasswordField:function(field,title){colorPasswordField(!0),trigger(field,title)},isValidEmail:function(emailId){return!("string"!=typeof emailId||!emailId.trim().match(emailExpression))},init:function(){fields=document.getElementsByClassName("is-required");document.querySelector("body").addEventListener("keypress",function(field){field=field.target;field.classList.contains("is-required")&&(field.onkeypress=function(elem){removeErrorMessage(this),this.parentElement.classList.remove("tooltip","invalid"),this.classList.remove("invalid"),"clm-sign-up-password-encrypted"==this.getAttribute("id")&&document.querySelector("#clm-sign-up-password-readable").classList.remove("invalid"),"clm-sign-up-confirm-password-encrypted"==this.getAttribute("id")&&document.querySelector("#clm-sign-up-confirm-password-readable").classList.remove("invalid")})},!0)}}}),angular.module("hereApp.service").factory("DataService",["$window","$http",function($window,$http){"use strict";return{getDobData:function(){return{days:_.range(1,32),months:$window.here&&$window.here.date&&$window.here.date.months,years:_.range((new Date).getFullYear()-150,(new Date).getFullYear()+1).reverse()}},getRealmInfo:function(realm,cb){$http.get("/api/account/realm?realmID="+realm).then(function(response){cb(response)},function(error){cb(error)})},getCarLanguagesList:function(){return{"de-DE":"Deutsch","en-GB":"English","es-ES":"Espa帽ol","fr-FR":"Fran莽ais","fr-CA":"Fran莽ais (Canadien)","it-IT":"Italiano","nl-NL":"Nederlands","pt-BR":"Portugu锚s (do Brasil)"}},getLanguagesList:function(){return{"en-GB":"English","zh-CN":"涓枃","ja-JP":"鏃ユ湰瑾�"}},getValidLanguageCode:function(inputCode,listOfAvailableLanguageCode){listOfAvailableLanguageCode=Object.keys(listOfAvailableLanguageCode);return _.find(listOfAvailableLanguageCode,function(key){return inputCode===key})||_.find(listOfAvailableLanguageCode,function(key){return inputCode===key.substr(0,key.indexOf("-"))})}}}]),angular.module("hereApp.service").factory("CommonService",["$window","TranslationService",function($window,TranslationService){"use strict";var passwordStrengthText={strong:"Password strength: strong",good:"Password strength: good",weak:"Password strength: weak",inadequate:"Password strength: insufficient"};return{isInviteTokenValid:function(){return!!($window.here.config.sdk&&!0===$window.here.config.sdk.active&&$window.here.config.sdk.decodedInviteToken&&$window.here.config.sdk.decodedInviteToken.email)&&!$window.here.config.sdk.decodedInviteToken.errorCode},getCookie:function(cname){for(var name=cname+"=",ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""},getQueryString:function(field,string){string=string||window.location.href,string=new RegExp("[?&]"+field+"=([^&#]*)","i").exec(string);return string?string[1]:null},updateUrlParameter:function(uri,key,value){var separator=uri.indexOf("#"),hash=-1===separator?"":uri.substr(separator);uri=-1===separator?uri:uri.substr(0,separator);var re=new RegExp("([?&])"+key+"=.*?(&|$)","i"),separator=-1!==uri.indexOf("?")?"&":"?";return(uri=uri.match(re)?uri.replace(re,"$1"+key+"="+value+"$2"):uri+separator+key+"="+value)+hash},createErrorBox:function(msg){var errorMsg,closeIcon,errorBox=document.getElementById("error-box");errorBox?(errorMsg=document.createElement("span"),closeIcon=document.createElement("span"),errorBox.classList.add("margin-bottom-1rem"),errorBox.appendChild(errorMsg),errorBox.appendChild(closeIcon),errorMsg.innerHTML=msg,closeIcon.setAttribute("class","close"),closeIcon.addEventListener("click",function(errorBox){errorBox.classList.remove("margin-bottom-1rem"),errorBox.innerHTML=""}(errorBox))):console.log("Error in createErrorBox() : Couldn't find div with id = 'error-box'.")},initPasswordStrength:function(){TranslationService.get("hereacc.web.label.pwstrength.strong",function(val){passwordStrengthText.strong=val,TranslationService.get("hereacc.web.label.pwstrength.good",function(val){passwordStrengthText.good=val,TranslationService.get("hereacc.web.label.pwstrength.weak",function(val){passwordStrengthText.weak=val,TranslationService.get("hereacc.web.label.pwstrength.inadequate",function(val){passwordStrengthText.inadequate=val})})})})},scorePassword:function(pass){var score=0;if(!pass)return score;if("correcthorsebatterystaple"===pass.toLowerCase())return 10;for(var letters=new Object,i=0;i<pass.length;i++)letters[pass[i]]=(letters[pass[i]]||0)+1,score+=5/letters[pass[i]];var check,variations={digits:/\d/.test(pass),lower:/[a-z]/.test(pass),upper:/[A-Z]/.test(pass),nonWords:/\W/.test(pass)},variationCount=0;for(check in variations)variationCount+=!0===variations[check]?1:0;return score+=10*(variationCount-1),parseInt(score)},getPasswordScoreMap:function(score){return 80<score?{value:4,message:passwordStrengthText.strong}:60<score?{value:3,message:passwordStrengthText.good}:30<=score?{value:2,message:passwordStrengthText.weak}:0<score?{value:1,message:passwordStrengthText.inadequate}:{value:0,message:"&nbsp;"}},getDateLocaleString:function(objDate_month,type){var date=new Date(objDate_month);if("Inavlid Date"===date||isNaN(date))return"";var objDate_date=$window.here.date.months||[],objDate_year=date.getFullYear(),objDate_month=_.find(objDate_date,function(m){return m.value===date.getMonth()+1}),objDate_date=date.getDate();return"short"===type?objDate_date+" "+objDate_month.med+" "+objDate_year:objDate_date+" "+objDate_month.long+" "+objDate_year}}}]);